define("discourse/plugins/discourse-question-answer/discourse/initializers/qa-edits",["exports","discourse/lib/plugin-api","ember-addons/ember-computed-decorators","virtual-dom","discourse/widgets/post","discourse/helpers/node","discourse/models/composer","../lib/qa-utilities","discourse/widgets/actions-summary","discourse/lib/posts-with-placeholders"],function(t,e,o,s,n,i,a,r,c,l){"use strict";function u(t,e,o,s,n){var i={};return Object.keys(s).forEach(function(t){i[t]=s[t]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,s){return s(t,e,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(t,e,i),i=null),i}Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"qa-edits",initialize:function(t){var p=t.lookup("store:main"),d=t.lookup("current-user:main"),m=t.lookup("site-settings:main");m.qa_enabled&&(0,e.withPluginApi)("0.8.12",function(t){function e(t,e){var o=this;if(e)return t=t||[],e.map(function(e){return o.attach("topic-participant",e,{state:{toggled:t.includes(e.username)}})})}var h,f,_,b,g,v,w,y,q,P,C,k;t.reopenWidget("post-menu",{menuItems:function(){var t=this.attrs,e=this.siteSettings.post_menu.split("|");return t.qa_enabled&&(!this.siteSettings.qa_disable_like_on_answers||t.firstPost||t.reply_to_post_number||(e=e.filter(function(t){return"like"!==t})),e=e.filter(function(t){return"reply"!==t})),e}}),t.decorateWidget("post:before",function(t){var e=t.getModel();if(e&&1!==e.get("post_number")&&!e.get("reply_to_post_number")&&e.get("qa_enabled"))return t.attach("qa-post",{count:e.get("qa_vote_count"),post:e})}),t.decorateWidget("post:after",function(t){var e=t.getModel();if(e.attachCommentToggle&&e.hiddenComments>0){var o=Number(m.qa_comments_default)>0?"more":"all";return t.attach("link",{action:"showComments",actionParam:e.answerId,rawLabel:I18n.t("topic.comment.show_comments."+o,{count:e.hiddenComments}),className:"show-comments"})}}),t.reopenWidget("post-stream",{buildKey:function(){return"post-stream"},defaultState:function(t,e){var o=this._super(t,e);return o.showComments=[],o},showComments:function(t){var e=this.state.showComments;-1===e.indexOf(t)&&(e.push(t),this.state.showComments=e,this.appEvents.trigger("post-stream:refresh",{force:!0}))},html:function(t,e){var o=t.posts||[],s=this.capabilities.isAndroid?o:o.toArray();if(s[0]&&s[0].qa_enabled){var n=null,i=e.showComments,a=Number(m.qa_comments_default),r=0,c=null;s.forEach(function(t,e){t.oneToMany=t.topic.category.qa_one_to_many,t.reply_to_post_number?(r++,t.comment=!0,t.showComment=i.indexOf(n)>-1||r<=a,t.answerId=n,t.attachCommentToggle=!1,t.showComment&&(c=e),s[e+1]&&s[e+1].reply_to_post_number||t.showComment||(s[c].answerId=n,s[c].attachCommentToggle=!0,s[c].hiddenComments=r-a)):(t.attachCommentToggle=!t.oneToMany,t.topicUserId=t.topic.user_id,n=t.id,r=0,c=e)}),this.capabilities.isAndroid?t.posts=s:t.posts=l.default.create({posts:s,store:p})}return this._super(t,e)}}),t.includePostAttributes("qa_enabled","reply_to_post_number","comment","showComment","answerId","lastComment","last_answerer","last_answered_at","answer_count","last_answer_post_number","last_answerer","topicUserId","oneToMany"),t.addPostClassesCallback(function(t){if(t.qa_enabled&&!t.firstPost){if(t.comment){var e=["comment"];return t.showComment&&e.push("show"),e}return["answer"]}}),t.addPostMenuButton("answer",function(t){if(t.canCreatePost&&t.qa_enabled&&t.firstPost&&(!t.oneToMany||t.topicUserId===d.id)){var e=t.oneToMany?"one_to_many":"answer",o={action:"replyToPost",title:"topic."+e+".help",icon:"reply",className:"answer create fade-out"};return t.mobileView||(o.label="topic."+e+".title"),o}}),t.addPostMenuButton("comment",function(t){if(t.canCreatePost&&t.qa_enabled&&!t.firstPost&&!t.reply_to_post_number){var e={action:"openCommentCompose",title:"topic.comment.help",icon:"comment",className:"comment create fade-out"};return t.mobileView||(e.label="topic.comment.title"),e}}),t.modifyClass("component:composer-actions",(h=(0,o.on)("init"),f=(0,o.default)("pluginPostSnapshot"),_=(0,o.default)("options","canWhisper","action","commenting"),b={setupPost:function(){var t=this.get("composerModel.post");t&&this.set("pluginPostSnapshot",t)},commenting:function(t){return t&&t.topic.qa_enabled&&!t.get("firstPost")&&!t.reply_to_post_number},computeHeaderContent:function(){var t=this._super();return this.get("commenting")&&this.get("action")===a.REPLY&&this.get("options.userAvatar")&&(t.icon="comment"),t},content:function(t,e,o,s){var n=this,i=this._super.apply(this,arguments);return s&&i.forEach(function(t){"reply_to_topic"===t.id&&(t.name=I18n.t("composer.composer_actions.reply_to_question.label"),t.description=I18n.t("composer.composer_actions.reply_to_question.desc")),"reply_to_post"===t.id&&(t.icon="comment",t.name=I18n.t("composer.composer_actions.comment_on_answer.label",{postUsername:n.get("pluginPostSnapshot.username")}),t.description=I18n.t("composer.composer_actions.comment_on_answer.desc"))}),i}},u(b,"setupPost",[h],Object.getOwnPropertyDescriptor(b,"setupPost"),b),u(b,"commenting",[f],Object.getOwnPropertyDescriptor(b,"commenting"),b),u(b,"content",[_],Object.getOwnPropertyDescriptor(b,"content"),b),b)),t.reopenWidget("post-body",{buildKey:function(t){return"post-body-"+t.id},defaultState:function(t){var e=this._super();return t.qa_enabled&&(e=$.extend({},e,{voters:[]})),e},html:function(t,e){var o=this._super(t,e),n=this.findAncestorModel(),i=n.actionByName.vote;if(i&&t.qa_enabled){var a=[];if(t.actionsSummary=t.actionsSummary.filter(function(t){return"vote"!==t.action}),i.acted&&i.can_undo&&a.push(this.attach("link",{action:"undoUserVote",rawLabel:I18n.t("post.actions.undo.vote")})),i.count>0&&a.push(this.attach("link",{action:"toggleWhoVoted",rawLabel:i.count+" "+I18n.t("post.actions.people.vote")})),a.length){var r=[(0,s.h)("div.vote-links",a)];e.voters.length&&r.push(this.attach("small-user-list",{users:e.voters,listClassName:"voters"}));var c=o.map(function(t){return t&&t.name}).indexOf("actions-summary"),l=c+1;o.splice(l-1,0,(0,s.h)("div.vote-container",r))}}return o},undoUserVote:function(){var t=this.findAncestorModel(),e=this.currentUser,o={user_id:e.id,post_id:t.id,direction:"up"};(0,r.undoVote)({vote:o}).then(function(e){e.success&&t.set("topic.voted",!1)})},toggleWhoVoted:function(){var t=this.state;if(!t.voters.length)return this.getWhoVoted();t.voters=[]},getWhoVoted:function(){var t=this,e=this.attrs,o=this.state,s={post_id:e.id};(0,r.whoVoted)(s).then(function(e){e.voters&&(o.voters=e.voters.map(c.avatarAtts),t.scheduleRerender())})}}),t.modifyClass("model:topic",(g=(0,o.default)("qa_enabled"),v={showQaTip:function(t){return t&&this.siteSettings.qa_show_topic_tip}},u(v,"showQaTip",[g],Object.getOwnPropertyDescriptor(v,"showQaTip"),v),v)),t.modifyClass("component:topic-footer-buttons",(w=(0,o.on)("didInsertElement"),y=(0,o.observes)("topic.qa_enabled"),q={hideFooterReply:function(){var t=this,e=this.get("topic.qa_enabled");Ember.run.scheduleOnce("afterRender",function(){t.$(".topic-footer-main-buttons > button.create:not(.answer)").toggle(!e)})}},u(q,"hideFooterReply",[w,y],Object.getOwnPropertyDescriptor(q,"hideFooterReply"),q),q)),t.modifyClass("model:post-stream",{prependPost:function(t){var e=this.storePost(t);if(e){var o=this.get("posts"),s=function(){return o.unshiftObject(e)};this.get("topic.qa_enabled")&&2===t.post_number&&1===o[0].post_number&&(s=function(){return o.insertAt(1,e)}),s()}return t},appendPost:function(t){var e=this.storePost(t);if(e){var o=this.get("posts");if(!o.includes(e)){var s=t.get("reply_to_post_number"),n=this.get("topic.qa_enabled"),i=function(){return o.pushObject(e)};if(n&&s){var a=!1;o.some(function(t,n){if(a&&!t.reply_to_post_number)return i=function(){return o.insertAt(n,e)},!0;t.post_number===s&&n<o.length-1&&(a=!0)})}this.get("loadingBelow")?i():this.get("postsWithPlaceholders").appendPost(i)}-1!==e.get("id")&&this.set("lastAppended",e)}return t}}),t.modifyClass("component:topic-progress",(P=(0,o.default)("postStream.loaded","topic.currentPost","postStream.filteredPostsCount","topic.qa_enabled"),C=(0,o.default)("progressPosition","topic.last_read_post_id","topic.qa_enabled"),k={hideProgress:function(t,e,o,s){return s||!t||!e||!this.site.mobileView&&o<2},showBackButton:function(t,e,o){if(e&&!o){var s=this.get("postStream.stream"),n=s.indexOf(e)||0;return n<s.length-1&&n>t}}},u(k,"hideProgress",[P],Object.getOwnPropertyDescriptor(k,"hideProgress"),k),u(k,"showBackButton",[C],Object.getOwnPropertyDescriptor(k,"showBackButton"),k),k)),t.modifyClass("component:topic-navigation",{_performCheckSize:function(){if(this.element&&!this.isDestroying&&!this.isDestroyed)if(this.get("topic.qa_enabled")){var t=this.get("info");t.setProperties({renderTimeline:!1,renderAdminMenuButton:!0})}else this._super.apply(this,arguments)}}),t.reopenWidget("post",{html:function(e){return e.cloaked?"":(e.qa_enabled&&!e.firstPost&&(e.replyToUsername=null,e.reply_to_post_number?(e.canCreatePost=!1,t.changeWidgetSetting("post-avatar","size","small")):(e.replyCount=null,t.changeWidgetSetting("post-avatar","size","large"))),this.attach("post-article",e))},openCommentCompose:function(){this.sendWidgetAction("showComments",this.attrs.id),this.sendWidgetAction("replyToPost",this.model)}}),t.reopenWidget("topic-map-summary",{html:function(t,e){return t.qa_enabled?this.qaMap(t,e):this._super(t,e)},qaMap:function(t,o){var a=[];a.push((0,s.h)("li",[(0,s.h)("h4",I18n.t("created_lowercase")),(0,s.h)("div.topic-map-post.created-at",[(0,n.avatarFor)("tiny",{username:t.createdByUsername,template:t.createdByAvatarTemplate,name:t.createdByName}),(0,i.dateNode)(t.topicCreatedAt)])]));var r=t.topicUrl+"/"+t.last_answer_post_number,c=t.oneToMany?"one_to_many":"answer";if(a.push((0,s.h)("li",(0,s.h)("a",{attributes:{href:r}},[(0,s.h)("h4",I18n.t("last_"+c+"_lowercase")),(0,s.h)("div.topic-map-post.last-answer",[(0,n.avatarFor)("tiny",{username:t.last_answerer.username,template:t.last_answerer.avatar_template,name:t.last_answerer.name}),(0,i.dateNode)(t.last_answered_at)])]))),a.push((0,s.h)("li",[(0,i.numberNode)(t.answer_count),(0,s.h)("h4",I18n.t(c+"_lowercase",{count:t.answer_count}))])),a.push((0,s.h)("li.secondary",[(0,i.numberNode)(t.topicViews,{className:t.topicViewsHeat}),(0,s.h)("h4",I18n.t("views_lowercase",{count:t.topicViews}))])),a.push((0,s.h)("li.secondary",[(0,i.numberNode)(t.participantCount),(0,s.h)("h4",I18n.t("users_lowercase",{count:t.participantCount}))])),t.topicLikeCount&&a.push((0,s.h)("li.secondary",[(0,i.numberNode)(t.topicLikeCount),(0,s.h)("h4",I18n.t("likes_lowercase",{count:t.topicLikeCount}))])),t.topicLinkLength>0&&a.push((0,s.h)("li.secondary",[(0,i.numberNode)(t.topicLinkLength),(0,s.h)("h4",I18n.t("links_lowercase",{count:t.topicLinkLength}))])),o.collapsed&&t.topicPostsCount>2&&t.participants.length>0){var l=e.call(this,t.userFilters,t.participants.slice(0,3));a.push((0,s.h)("li.avatars",l))}return[(0,s.h)("nav.buttons",this.attach("button",{title:"topic.toggle_information",icon:o.collapsed?"chevron-down":"chevron-up",action:"toggleMap",className:"btn"})),(0,s.h)("ul.clearfix",a)]}})})}}}),Ember.TEMPLATES["javascripts/discourse/connectors/after-topic-footer-main-buttons/answer-button-wrapper"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[25,["showCreateAnswer"]]],null,{"statements":[[0,"  "],[1,[29,"d-button",null,[["class","icon","action","label","title"],["btn-primary create answer","reply","answerQuestion",[25,["label"]],[25,["title"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/after-topic-footer-main-buttons/answer-button-wrapper"}}),define("discourse/plugins/discourse-question-answer/discourse/connectors/after-topic-footer-main-buttons/answer-button-wrapper",["exports","discourse-common/lib/get-owner"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={setupComponent:function(t,e){var o=e.get("currentUser"),s=t.topic,n=s.category&&s.category.qa_one_to_many,i=s.qa_enabled,a=s.get("details.can_create_post"),r=i&&a&&(!n||s.user_id==o.id),c=void 0,l=void 0;if(r){var u=n?"one_to_many":"answer";c="topic."+u+".title",l="topic."+u+".help"}e.setProperties({showCreateAnswer:r,label:c,title:l})},actions:{answerQuestion:function(){(0,e.getOwner)(this).lookup("controller:topic").send("replyToPost")}}}}),define("discourse/plugins/discourse-question-answer/discourse/connectors/category-custom-settings/enable-qa",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={setupComponent:function(t){t.category.custom_fields||(t.category.custom_fields={})}}}),Ember.TEMPLATES["javascripts/discourse/connectors/category-custom-settings/enable-qa"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"section"],[11,"class","field"],[9],[0,"\\n  "],[7,"label"],[9],[0,"\\n    "],[1,[29,"input",null,[["type","checked"],["checkbox",[25,["category","custom_fields","qa_enabled"]]]]],false],[0,"\\n    "],[1,[29,"i18n",["category.enable_qa"],null],false],[0,"\\n  "],[10],[0,"\\n"],[10],[0,"\\n\\n"],[7,"section"],[11,"class","field"],[9],[0,"\\n  "],[7,"label"],[9],[0,"\\n    "],[1,[29,"input",null,[["type","checked"],["checkbox",[25,["category","custom_fields","qa_one_to_many"]]]]],false],[0,"\\n    "],[1,[29,"i18n",["category.qa_one_to_many"],null],false],[0,"\\n  "],[10],[0,"\\n"],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/category-custom-settings/enable-qa"}}),Ember.TEMPLATES["javascripts/discourse/connectors/topic-title/qa-tip-container"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[25,["showTip"]]],null,{"statements":[[0,"  "],[1,[29,"qa-topic-tip",null,[["label","details","detailsOpts"],[[25,["label"]],[25,["details"]],[25,["detailsOpts"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/connectors/topic-title/qa-tip-container"}}),define("discourse/plugins/discourse-question-answer/discourse/connectors/topic-title/qa-tip-container",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={setupComponent:function(t,e){var o=t.model.category&&t.model.category.qa_one_to_many,s=t.model.siteSettings,n=t.model.showQaTip,i=o?"qa_one_to_many":"qa",a="topic.tip."+i+".title",r="topic.tip."+i+".details",c={tl1Limit:s.qa_tl1_vote_limit,tl2Limit:s.qa_tl2_vote_limit,tl3Limit:s.qa_tl3_vote_limit,tl4Limit:s.qa_tl4_vote_limit};e.setProperties({showTip:n,label:a,details:r,detailsOpts:c})}}}),Ember.TEMPLATES["javascripts/components/qa-topic-tip"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[29,"d-button",null,[["class","action","label","icon"],["btn btn-topic-tip","toggleDetails",[25,["label"]],"info"]]],false],[0,"\\n"],[4,"if",[[25,["showDetails"]]],null,{"statements":[[0,"  "],[7,"div"],[11,"class","tip-details"],[9],[0,"\\n    "],[1,[23,"cookedDetails"],false],[0,"\\n  "],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/components/qa-topic-tip"}}),define("discourse/plugins/discourse-question-answer/discourse/lib/qa-utilities",["exports","discourse/lib/ajax-error","discourse/lib/ajax"],function(t,e,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.whoVoted=t.voteActionId=t.castVote=t.undoVote=void 0;var s=function(t,s){return(0,o.ajax)("/qa/vote",{type:t,data:s}).catch(e.popupAjaxError)},n=function(t){return s("DELETE",t)},i=function(t){return s("POST",t)},a=function(t){return(0,o.ajax)("/qa/voters",{type:"GET",data:t}).catch(e.popupAjaxError)};t.undoVote=n,t.castVote=i,t.voteActionId=100,t.whoVoted=a}),define("discourse/plugins/discourse-question-answer/discourse/components/qa-topic-tip",["exports","discourse/lib/text"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=Ember.Component.extend({classNames:"qa-topic-tip",didInsertElement:function(){var t=this;Ember.$(document).on("click",Ember.run.bind(this,this.documentClick));var o=I18n.t(this.get("details"),this.get("detailsOpts"));o&&(0,e.cookAsync)(o).then(function(e){t.set("cookedDetails",e)})},willDestroyElement:function(){Ember.$(document).off("click",Ember.run.bind(this,this.documentClick))},documentClick:function(t){var e=this.$();$(t.target).closest(e).length<1&&"destroying"!==this._state&&this.set("showDetails",!1)},actions:{toggleDetails:function(){this.toggleProperty("showDetails")}}})}),define("discourse/plugins/discourse-question-answer/discourse/widgets/qa-post",["exports","discourse/widgets/widget","../lib/qa-utilities","virtual-dom"],function(t,e,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,e.createWidget)("qa-post",{tagName:"div.qa-post",sendShowLogin:function(){this.register.lookup("route:application").send("showLogin")},html:function(t){return[this.attach("qa-button",{direction:"up"}),(0,s.h)("div.count",""+t.count)]},vote:function(t){var e=this.currentUser;if(!e)return this.sendShowLogin();var s=this.attrs.post,n={user_id:e.id,post_id:s.id,direction:t};(0,o.castVote)({vote:n}).then(function(t){t.success&&(s.set("topic.qa_voted",!0),t.qa_can_vote&&s.set("topic.qa_can_vote",t.qa_can_vote),t.qa_votes&&s.set("topic.qa_votes",t.qa_votes))})}})}),define("discourse/plugins/discourse-question-answer/discourse/widgets/qa-button",["exports","discourse/widgets/widget","discourse-common/lib/icon-library"],function(t,e,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,e.createWidget)("qa-button",{tagName:"button.btn.qa-button",html:function(t){return(0,o.iconNode)("angle-"+t.direction)},click:function(){this.sendWidgetAction("vote",this.attrs.direction)}})});
//# sourceMappingURL=/assets/plugins/discourse-question-answer-9785b2ed884e61548cee1a524196cf2157e31a2054f044a5ebe460abdd8c055f.js.map