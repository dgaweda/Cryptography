!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(process){!function(definition){if("object"==typeof exports)module.exports=definition();else if("function"==typeof define&&define.amd)define(definition);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=definition}else Q=definition()}(function(){"use strict";function uncurryThis(f){return function(){return call.apply(f,arguments)}}function isObject(value){return value===Object(value)}function isStopIteration(exception){return"[object StopIteration]"===object_toString(exception)||exception instanceof QReturnValue}function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&"object"==typeof error&&null!==error&&error.stack&&error.stack.indexOf(STACK_JUMP_SEPARATOR)===-1){for(var stacks=[],p=promise;p;p=p.source)p.stack&&stacks.unshift(p.stack);stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){for(var lines=stackString.split("\n"),desiredLines=[],i=0;i<lines.length;++i){var line=lines[i];isInternalFrame(line)||isNodeFrame(line)||!line||desiredLines.push(line)}return desiredLines.join("\n")}function isNodeFrame(stackLine){return stackLine.indexOf("(module.js:")!==-1||stackLine.indexOf("(node.js:")!==-1}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1)return[attempt1[1],Number(attempt1[2])];var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2)return[attempt2[1],Number(attempt2[2])];var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);return attempt3?[attempt3[1],Number(attempt3[2])]:void 0}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber)return!1;var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&lineNumber<=qEndingLine}function captureLine(){if(hasStacks)try{throw new Error}catch(e){var lines=e.stack.split("\n"),firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2],fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber)return;return qFileName=fileNameAndLineNumber[0],fileNameAndLineNumber[1]}}function deprecate(callback,name,alternative){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack),callback.apply(callback,arguments)}}function Q(value){return isPromise(value)?value:isPromiseAlike(value)?coerce(value):fulfill(value)}function defer(){function become(newPromise){resolvedPromise=newPromise,promise.source=newPromise,array_reduce(messages,function(undefined,message){nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message)})},void 0),messages=void 0,progressListeners=void 0}var resolvedPromise,messages=[],progressListeners=[],deferred=object_create(defer.prototype),promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);messages?(messages.push(args),"when"===op&&operands[1]&&progressListeners.push(operands[1])):nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args)})},promise.valueOf=function(){if(messages)return promise;var nearerValue=nearer(resolvedPromise);return isPromise(nearerValue)&&(resolvedPromise=nearerValue),nearerValue},promise.inspect=function(){return resolvedPromise?resolvedPromise.inspect():{state:"pending"}},Q.longStackSupport&&hasStacks)try{throw new Error}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return deferred.promise=promise,deferred.resolve=function(value){resolvedPromise||become(Q(value))},deferred.fulfill=function(value){resolvedPromise||become(fulfill(value))},deferred.reject=function(reason){resolvedPromise||become(reject(reason))},deferred.notify=function(progress){resolvedPromise||array_reduce(progressListeners,function(undefined,progressListener){nextTick(function(){progressListener(progress)})},void 0)},deferred}function promise(resolver){if("function"!=typeof resolver)throw new TypeError("resolver must be a function.");var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify)}catch(reason){deferred.reject(reason)}return deferred.promise}function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;i<len;i++)Q(answerPs[i]).then(resolve,reject)})}function Promise(descriptor,fallback,inspect){void 0===fallback&&(fallback=function(op){return reject(new Error("Promise does not support operation: "+op))}),void 0===inspect&&(inspect=function(){return{state:"unknown"}});var promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,args){var result;try{result=descriptor[op]?descriptor[op].apply(promise,args):fallback.call(promise,op,args)}catch(exception){result=reject(exception)}resolve&&resolve(result)},promise.inspect=inspect,inspect){var inspected=inspect();"rejected"===inspected.state&&(promise.exception=inspected.reason),promise.valueOf=function(){var inspected=inspect();return"pending"===inspected.state||"rejected"===inspected.state?promise:inspected.value}}return promise}function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed)}function nearer(value){if(isPromise(value)){var inspected=value.inspect();if("fulfilled"===inspected.state)return inspected.value}return value}function isPromise(object){return isObject(object)&&"function"==typeof object.promiseDispatch&&"function"==typeof object.inspect}function isPromiseAlike(object){return isObject(object)&&"function"==typeof object.then}function isPending(object){return isPromise(object)&&"pending"===object.inspect().state}function isFulfilled(object){return!isPromise(object)||"fulfilled"===object.inspect().state}function isRejected(object){return isPromise(object)&&"rejected"===object.inspect().state}function resetUnhandledRejections(){unhandledReasons.length=0,unhandledRejections.length=0,trackUnhandledRejections||(trackUnhandledRejections=!0)}function trackRejection(promise,reason){trackUnhandledRejections&&(unhandledRejections.push(promise),reason&&"undefined"!=typeof reason.stack?unhandledReasons.push(reason.stack):unhandledReasons.push("(no stack) "+reason))}function untrackRejection(promise){if(trackUnhandledRejections){var at=array_indexOf(unhandledRejections,promise);at!==-1&&(unhandledRejections.splice(at,1),unhandledReasons.splice(at,1))}}function reject(reason){var rejection=Promise({when:function(rejected){return rejected&&untrackRejection(this),rejected?rejected(reason):this}},function(){return this},function(){return{state:"rejected",reason:reason}});return trackRejection(rejection,reason),rejection}function fulfill(value){return Promise({when:function(){return value},get:function(name){return value[name]},set:function(name,rhs){value[name]=rhs},"delete":function(name){delete value[name]},post:function(name,args){return null===name||void 0===name?value.apply(void 0,args):value[name].apply(value,args)},apply:function(thisp,args){return value.apply(thisp,args)},keys:function(){return object_keys(value)}},void 0,function(){return{state:"fulfilled",value:value}})}function coerce(promise){var deferred=defer();return nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify)}catch(exception){deferred.reject(exception)}}),deferred.promise}function master(object){return Promise({isDef:function(){}},function(op,args){return dispatch(object,op,args)},function(){return Q(object).inspect()})}function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected)}function async(makeGenerator){return function(){function continuer(verb,arg){var result;if("undefined"==typeof StopIteration){try{result=generator[verb](arg)}catch(exception){return reject(exception)}return result.done?result.value:when(result.value,callback,errback)}try{result=generator[verb](arg)}catch(exception){return isStopIteration(exception)?exception.value:reject(exception)}return when(result,callback,errback)}var generator=makeGenerator.apply(this,arguments),callback=continuer.bind(continuer,"next"),errback=continuer.bind(continuer,"throw");return callback()}}function spawn(makeGenerator){Q.done(Q.async(makeGenerator)())}function _return(value){throw new QReturnValue(value)}function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args)})}}function dispatch(object,op,args){return Q(object).dispatch(op,args)}function all(promises){return when(promises,function(promises){var countDown=0,deferred=defer();return array_reduce(promises,function(undefined,promise,index){var snapshot;isPromise(promise)&&"fulfilled"===(snapshot=promise.inspect()).state?promises[index]=snapshot.value:(++countDown,when(promise,function(value){promises[index]=value,0===--countDown&&deferred.resolve(promises)},deferred.reject,function(progress){deferred.notify({index:index,value:progress})}))},void 0),0===countDown&&deferred.resolve(promises),deferred.promise})}function allResolved(promises){return when(promises,function(promises){return promises=array_map(promises,Q),when(all(array_map(promises,function(promise){return when(promise,noop,noop)})),function(){return promises})})}function allSettled(promises){return Q(promises).allSettled()}function progress(object,progressed){return Q(object).then(void 0,void 0,progressed)}function nodeify(object,nodeback){return Q(object).nodeify(nodeback)}var hasStacks=!1;try{throw new Error}catch(e){hasStacks=!!e.stack}var qFileName,QReturnValue,qStartingLine=captureLine(),noop=function(){},nextTick=function(){function flush(){for(;head.next;){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;domain&&(head.domain=void 0,domain.enter());try{task()}catch(e){if(isNodeJS)throw domain&&domain.exit(),setTimeout(flush,0),domain&&domain.enter(),e;setTimeout(function(){throw e},0)}domain&&domain.exit()}flushing=!1}var head={task:void 0,next:null},tail=head,flushing=!1,requestTick=void 0,isNodeJS=!1;if(nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null},flushing||(flushing=!0,requestTick())},"undefined"!=typeof process&&process.nextTick)isNodeJS=!0,requestTick=function(){process.nextTick(flush)};else if("function"==typeof setImmediate)requestTick="undefined"!=typeof window?setImmediate.bind(window,flush):function(){setImmediate(flush)};else if("undefined"!=typeof MessageChannel){var channel=new MessageChannel;channel.port1.onmessage=function(){requestTick=requestPortTick,channel.port1.onmessage=flush,flush()};var requestPortTick=function(){channel.port2.postMessage(0)};requestTick=function(){setTimeout(flush,0),requestPortTick()}}else requestTick=function(){setTimeout(flush,0)};return nextTick}(),call=Function.call,array_slice=uncurryThis(Array.prototype.slice),array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(1===arguments.length)for(;;){if(index in this){basis=this[index++];break}if(++index>=length)throw new TypeError}for(;index<length;index++)index in this&&(basis=callback(basis,this[index],index));return basis}),array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++)if(this[i]===value)return i;return-1}),array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this,collect=[];return array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self))},void 0),collect}),object_create=Object.create||function(prototype){function Type(){}return Type.prototype=prototype,new Type},object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty),object_keys=Object.keys||function(object){var keys=[];for(var key in object)object_hasOwnProperty(object,key)&&keys.push(key);return keys},object_toString=uncurryThis(Object.prototype.toString);QReturnValue="undefined"!=typeof ReturnValue?ReturnValue:function(value){this.value=value};var STACK_JUMP_SEPARATOR="From previous event:";Q.resolve=Q,Q.nextTick=nextTick,Q.longStackSupport=!1,Q.defer=defer,defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){error?self.reject(error):arguments.length>2?self.resolve(array_slice(arguments,1)):self.resolve(value)}},Q.Promise=promise,Q.promise=promise,promise.race=race,promise.all=all,promise.reject=reject,promise.resolve=Q,Q.passByCopy=function(object){return object},Promise.prototype.passByCopy=function(){return this},Q.join=function(x,y){return Q(x).join(y)},Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y)return x;throw new Error("Can't join: not the same: "+x+" "+y)})},Q.race=race,Promise.prototype.race=function(){return this.then(Q.race)},Q.makePromise=Promise,Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.then=function(fulfilled,rejected,progressed){function _fulfilled(value){try{return"function"==typeof fulfilled?fulfilled(value):value}catch(exception){return reject(exception)}}function _rejected(exception){if("function"==typeof rejected){makeStackTraceLong(exception,self);try{return rejected(exception)}catch(newException){return reject(newException)}}return reject(exception)}function _progressed(value){return"function"==typeof progressed?progressed(value):value}var self=this,deferred=defer(),done=!1;return nextTick(function(){self.promiseDispatch(function(value){done||(done=!0,deferred.resolve(_fulfilled(value)))},"when",[function(exception){done||(done=!0,deferred.resolve(_rejected(exception)))}])}),self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue,threw=!1;try{newValue=_progressed(value)}catch(e){if(threw=!0,!Q.onerror)throw e;Q.onerror(e)}threw||deferred.notify(newValue)}]),deferred.promise},Q.when=when,Promise.prototype.thenResolve=function(value){return this.then(function(){return value})},Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value)},Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason})},Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason)},Q.nearer=nearer,Q.isPromise=isPromise,Q.isPromiseAlike=isPromiseAlike,Q.isPending=isPending,Promise.prototype.isPending=function(){return"pending"===this.inspect().state},Q.isFulfilled=isFulfilled,Promise.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},Q.isRejected=isRejected,Promise.prototype.isRejected=function(){return"rejected"===this.inspect().state};var unhandledReasons=[],unhandledRejections=[],trackUnhandledRejections=!0;Q.resetUnhandledRejections=resetUnhandledRejections,Q.getUnhandledReasons=function(){return unhandledReasons.slice()},Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections(),trackUnhandledRejections=!1},resetUnhandledRejections(),Q.reject=reject,Q.fulfill=fulfill,Q.master=master,Q.spread=spread,Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array)},rejected)},Q.async=async,Q.spawn=spawn,Q["return"]=_return,Q.promised=promised,Q.dispatch=dispatch,Promise.prototype.dispatch=function(op,args){var self=this,deferred=defer();return nextTick(function(){self.promiseDispatch(deferred.resolve,op,args)}),deferred.promise},Q.get=function(object,key){return Q(object).dispatch("get",[key])},Promise.prototype.get=function(key){return this.dispatch("get",[key])},Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value])},Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value])},Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key])},Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key])},Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args])},Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args])},Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)])},Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)])},Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args])},Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args])},Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)])},Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)])},Q.fbind=function(object){var promise=Q(object),args=array_slice(arguments,1);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Promise.prototype.fbind=function(){var promise=this,args=array_slice(arguments);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Q.keys=function(object){return Q(object).dispatch("keys",[])},Promise.prototype.keys=function(){return this.dispatch("keys",[])},Q.all=all,Promise.prototype.all=function(){return all(this)},Q.allResolved=deprecate(allResolved,"allResolved","allSettled"),Promise.prototype.allResolved=function(){return allResolved(this)},Q.allSettled=allSettled,Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){function regardless(){return promise.inspect()}return promise=Q(promise),promise.then(regardless,regardless)}))})},Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected)},Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected)},Q.progress=progress,Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed)},Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback)},Promise.prototype.fin=Promise.prototype["finally"]=function(callback){return callback=Q(callback),this.then(function(value){return callback.fcall().then(function(){return value})},function(reason){return callback.fcall().then(function(){throw reason})})},Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress)},Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){nextTick(function(){if(makeStackTraceLong(error,promise),!Q.onerror)throw error;Q.onerror(error)})},promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;"object"==typeof process&&process&&process.domain&&(onUnhandledError=process.domain.bind(onUnhandledError)),promise.then(void 0,onUnhandledError)},Q.timeout=function(object,ms,message){return Q(object).timeout(ms,message)},Promise.prototype.timeout=function(ms,message){var deferred=defer(),timeoutId=setTimeout(function(){deferred.reject(new Error(message||"Timed out after "+ms+" ms"))},ms);return this.then(function(value){clearTimeout(timeoutId),deferred.resolve(value)},function(exception){clearTimeout(timeoutId),deferred.reject(exception)},deferred.notify),deferred.promise},Q.delay=function(object,timeout){return void 0===timeout&&(timeout=object,object=void 0),Q(object).delay(timeout)},Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();return setTimeout(function(){deferred.resolve(value)},timeout),deferred.promise})},Q.nfapply=function(callback,args){return Q(callback).nfapply(args)},Promise.prototype.nfapply=function(args){var deferred=defer(),nodeArgs=array_slice(args);return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args)},Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfbind=Q.denodeify=function(callback){var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(callback).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);return args.unshift(this),Q.denodeify.apply(void 0,args)},Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){function bound(){return callback.apply(thisp,arguments)}var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(bound).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nbind=function(){var args=array_slice(arguments,0);return args.unshift(this),Q.nbind.apply(void 0,args)},Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args)},Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nodeify=nodeify,Promise.prototype.nodeify=function(nodeback){return nodeback?void this.then(function(value){nextTick(function(){nodeback(null,value)})},function(error){nextTick(function(){nodeback(error)})}):this};var qEndingLine=captureLine();return Q})}).call(this,require("Wb8Gej"))},{Wb8Gej:18}],2:[function(require,module,exports){!function(name,definition,context){"undefined"!=typeof module&&module.exports?module.exports=definition():"function"==typeof context.define&&context.define.amd?define(definition):context[name]=definition()}("tim",function(){var tim=function createTim(initSettings){"use strict";function patternCache(){pattern=new RegExp(settings.start+"\\s*("+settings.path+")\\s*"+settings.end,"gi")}function settingsCache(newSettings){var s;if(newSettings){for(s in newSettings)newSettings.hasOwnProperty(s)&&(settings[s]=newSettings[s]);patternCache()}return settings}function templatesCache(key,value){var t;switch(typeof key){case"string":if(value===undef)return templates[key]||"";value===!1?delete templates[key]:templates[key]=value;break;case"object":for(t in key)key.hasOwnProperty(t)&&templatesCache(t,key[t]);break;case"boolean":key||(templates={})}return templates}function extend(obj1,obj2){var key;for(key in obj2)obj2.hasOwnProperty(key)&&(obj1[key]=obj2[key]);return obj1}function sortByPriority(a,b){return a[1]-b[1]}function addFilter(filterName,fn,priority){var fns=filters[filterName];return fns||(fns=filters[filterName]=[]),fns.push([fn,priority||0]),fns.sort(sortByPriority),fn}function applyFilter(filterName,payload){var args,i,len,substituted,fns=filters[filterName];if(fns){for(args=[payload],i=2,len=arguments.length;i<len;i++)args.push(arguments[i]);for(i=0,len=fns.length;i<len;i++)if(args[0]=payload,substituted=fns[i][0].apply(null,args),payload!==undef&&substituted!==undef&&(payload=substituted),null===substituted&&(payload=""),stopThisFilter){stopThisFilter=!1;break}}return payload}function filter(filterName,payload){return("function"==typeof payload?addFilter:applyFilter).apply(null,arguments)}function substitute(template,data){for(var match,token,substituted,startPos,endPos,templateStart,templateEnd,subTemplate,closeToken,closePos,key,loopData,loop;null!==(match=pattern.exec(template));){if(token=match[1],substituted=applyFilter("token",token,data,template),startPos=match.index,endPos=pattern.lastIndex,templateStart=template.slice(0,startPos),templateEnd=template.slice(endPos),"function"==typeof substituted&&(substituted=substituted.call(data)),"boolean"!=typeof substituted&&"object"!=typeof substituted)template=templateStart+substituted+templateEnd;else{if(subTemplate="",closeToken=settings.start+"/"+token+settings.end,closePos=templateEnd.indexOf(closeToken),!(closePos>=0))throw"tim: '"+token+"' not closed";if(templateEnd=templateEnd.slice(0,closePos),"boolean"==typeof substituted)subTemplate=substituted?templateEnd:"";else{for(key in substituted)substituted.hasOwnProperty(key)&&(pattern.lastIndex=0,loopData=extend({_key:key,_content:substituted[key]},substituted[key]),loopData=applyFilter("loopData",loopData,loop,token),loop=tim(templateEnd,loopData),subTemplate+=applyFilter("loop",loop,token,loopData));subTemplate=applyFilter("loopEnd",subTemplate,token,loopData)}template=templateStart+subTemplate+template.slice(endPos+templateEnd.length+closeToken.length)}pattern.lastIndex=0}return template}function tim(template,data){var templateLookup;return initialized||(initialized=1,applyFilter("init")),template=applyFilter("templateBefore",template),template.indexOf(settings.start)<0&&(templateLookup=templatesCache(template),templateLookup&&(template=templateLookup)),template=applyFilter("template",template),template&&data!==undef&&(template=substitute(template,data)),template=applyFilter("templateAfter",template)}var stopThisFilter,pattern,initialized,undef,settings={start:"{{",end:"}}",path:"[a-z0-9_$][\\.a-z0-9_]*"},templates={},filters={};return initSettings?settingsCache(initSettings):patternCache(),filter.stop=function(){stopThisFilter=!0},tim.settings=settingsCache,tim.templates=templatesCache,tim.parser=createTim,tim.filter=filter,addFilter("token",function(token,data,tag){for(var path=token.split("."),len=path.length,dataLookup=data,i=0;i<len;i++){if(dataLookup=dataLookup[path[i]],dataLookup===undef)throw"tim: '"+path[i]+"' not found"+(i?" in "+tag:"");if(i===len-1)return dataLookup}}),window&&window.document&&(tim.dom=function(domSettings){domSettings=domSettings||{};for(var elem,key,type=domSettings.type||settings.type||"text/tim",attr=domSettings.attr||settings.attr||"class",document=window.document,hasQuery=!!document.querySelectorAll,elements=hasQuery?document.querySelectorAll("script[type='"+type+"']"):document.getElementsByTagName("script"),i=0,len=elements.length,templatesInDom={};i<len;i++)elem=elements[i],key="class"===attr?elem.className:elem.getAttribute(attr),key&&(hasQuery||elem.type===type)&&(templatesInDom[key]=elem.innerHTML);return templatesCache(templatesInDom),templatesInDom},addFilter("init",function(){tim.dom()})),tim}();return tim},this)},{}],3:[function(require,module,exports){"use strict";var browserUtils=require("./utils/browser"),utils=require("./utils/common"),textUtils=require("./utils/text"),FEATURES={words:"modwords",links:"modlinks",showcase:"modshowcase"},FREQUENCY={maximum:{horDist:1,verDist:1,verDistSamePhrase:1,horDistSamePhrase:1},optimum:{horDist:80,verDist:80,verDistSamePhrase:800,horDistSamePhrase:800},minimum:{horDist:200,verDist:300,verDistSamePhrase:3e3,horDistSamePhrase:3e3},custom:{horDist:120,verDist:60,verDistSamePhrase:600,horDistSamePhrase:600}};module.exports={api:{host:function(host){var h=host.replace("http://","").replace("https://","").replace("//","");return location.protocol+"//"+h}("//converti.se"),locate:"/convertext/",locate_links:"/convertext/links/"},modulesSettings:{words:{linkClass:"ctxt-link"},suggestions:{prefix:"ctxt",type:"horizontal",hDelay:300},showCase:{prefix:"ctxt",max_products:6,selector:"[data-widget=convertiser-showcase]"}},features:FEATURES,css:{id:"ctxt-style",url:"/static/convertext/convertext.css"},settings:{debug:!1,theme:"red",frequency:"optimum",key:0,widget:!0,positive_cls:"ctxt-target-node",negative_cls:"ctxt-skip",link_density:.5,ignore_domains:"",features:[FEATURES.words,FEATURES.links]},isCustomPositiveCls:function(){var prop=this.settings.positive_cls;return!(!utils.isArray(prop)&&!utils.isString(prop)||!prop.length)&&"ctxt-target-node"!==prop},getPositiveCls:function(){var elements=[],prop=this.settings.positive_cls;return this.isCustomPositiveCls()?utils.isArray(prop)?utils.each(prop,function(cssClass){for(var items=browserUtils.getDocument().getElementsByClassName(cssClass),i=0;i<items.length;i++)elements.push(items[i])}):elements=browserUtils.getDocument().getElementsByClassName(prop):elements=browserUtils.getDocument().getElementsByTagName("body"),elements},configure:function(params){if(params.key||utils.throwError("Please provide a valid account 'key'."),!utils.isUndefined(params.link_vs_widget_proximity)&&utils.isUndefined(params.link_density)&&(params.link_density=params.link_vs_widget_proximity),!utils.isUndefined(params.highlightText)&&utils.isUndefined(params.debug)&&(params.debug=params.highlightText),!utils.isUndefined(params.className)&&utils.isUndefined(params.positive_cls)&&(params.positive_cls=params.className),!utils.isUndefined(params.positive_cls)&&params.positive_cls.indexOf(",")!==-1){var positive_cls=params.positive_cls.split(",");params.positive_cls=positive_cls.map(function(item){return textUtils.trim(item)})}if(!utils.isUndefined(params.negative_cls)&&params.negative_cls.indexOf(",")!==-1){var negative_cls=params.negative_cls.split(",");params.negative_cls=negative_cls.map(function(item){return textUtils.trim(item)})}if(!utils.isUndefined(params.ignore_domains)&&params.ignore_domains.indexOf(",")!==-1){var ignore_domains=params.ignore_domains.split(",");params.ignore_domains=ignore_domains.map(function(item){return textUtils.trim(item)})}if(params=utils.extend(this.settings,params),this.settings.debug){var i=browserUtils.getDocument().createElement("iframe");i.style.display="none",browserUtils.getDocument().body.appendChild(i),browserUtils.getWindow().console=i.contentWindow.console}var frequencies=utils.getKeys(FREQUENCY);return params.frequency&&utils.isInArray(frequencies,params.frequency)?"custom"===params.frequency?params.horDist||params.verDist?(this.modulesSettings.words.horDist=params.horDist,this.modulesSettings.words.verDist=params.verDist,this.modulesSettings.words.verDistSamePhrase=params.verDistSamePhrase||FREQUENCY[params.frequency].verDistSamePhrase,this.modulesSettings.words.horDistSamePhrase=params.horDistSamePhrase||FREQUENCY[params.frequency].horDistSamePhrase,this.modulesSettings.words.frequency=params.frequency):utils.throwError("Please provide a valid parameters 'horDist' and 'verDist' for custom 'frequency'."):(this.modulesSettings.words.horDist=FREQUENCY[params.frequency].horDist,this.modulesSettings.words.verDist=FREQUENCY[params.frequency].verDist,this.modulesSettings.words.verDistSamePhrase=FREQUENCY[params.frequency].verDistSamePhrase,this.modulesSettings.words.horDistSamePhrase=FREQUENCY[params.frequency].horDistSamePhrase,this.modulesSettings.words.frequency=params.frequency):utils.throwError("Please provide a valid parameter 'frequency'.\n Possible values are '"+frequencies.join("', '")+"'."),this.css.url=this.api.host+this.css.url,params}}},{"./utils/browser":9,"./utils/common":10,"./utils/text":17}],4:[function(require,module,exports){"use strict";function ConverText(_options_){function run(){modules.modlinks&&modules.modlinks.processAnchors().then(handleLinksProcessing),
extract.usableTextNodes(function(extract){!modules.modwords||modules.modlinks||modules.modshowcase||modules.modwords.process(extract).then(handleProcessing),!modules.modlinks||modules.modwords||modules.modshowcase||modules.modlinks.process(extract).then(handleLinksProcessing).then(linskWatcher),!modules.modshowcase||modules.modlinks||modules.modwords||modules.modshowcase.process(extract).then(handleProcessing),modules.modwords&&modules.modlinks&&!modules.modshowcase&&modules.modlinks.process(extract).then(handleLinksProcessing).then(function(){return modules.modwords.process(extract)}).then(handleProcessing).then(linskWatcher),modules.modwords&&modules.modshowcase&&!modules.modlinks&&modules.modshowcase.process(extract).then(handleProcessing).then(function(){return modules.modwords.process(extract)}).then(handleProcessing),modules.modlinks&&modules.modshowcase&&!modules.modwords&&modules.modlinks.process(extract).then(handleLinksProcessing).then(function(){return modules.modshowcase.process(extract)}).then(handleProcessing).then(linskWatcher),modules.modwords&&modules.modlinks&&modules.modshowcase&&modules.modlinks.process(extract).then(handleLinksProcessing).then(function(){return modules.modshowcase.process(extract)}).then(handleProcessing).then(function(){return modules.modwords.process(extract)}).then(handleProcessing).then(linskWatcher)})}function handleProcessing(results){return utils.extend(processingResults,results),Object.keys(modules).length===Object.keys(processingResults).length&&(utils.extend(processingResults,{title:extract.title(),url:extract.url(),settings:config.settings}),delete processingResults.modlinks,sendToApi(config.api.locate,jsonUtils.stringify(processingResults),handleResponse,0)),Q.resolve()}function handleLinksProcessing(results){if(utils.extend(processingResults,results),!results.modlinks||!results.modlinks.length)return Q.resolve();var params=utils.extend({},results,{title:extract.title(),url:extract.url(),settings:{key:config.settings.key}});return sendToApi(config.api.locate_links,jsonUtils.stringify(params),handleLinksResponse,0),Q.resolve()}function handleResponse(response){modules.modwords&&!modules.modshowcase&&modules.modwords.setUpAffiliation(response),modules.modshowcase&&!modules.modwords&&modules.modshowcase.setUpAffiliation(response),modules.modwords&&modules.modshowcase&&modules.modshowcase.setUpAffiliation(response).then(function(){return modules.modwords.setUpAffiliation(response)})}function handleLinksResponse(response){modules.modlinks.setUpAffiliation(response)}function linskWatcher(){linksWatcher=setInterval(function(){modules.modlinks.watcher().then(handleLinksProcessing)},3e3)}function sendToApi(path,data,cb,delay){function request(path,data,cb,delay){setTimeout(function(){http.post(path,data,function(response){200===response.status?cb(response.data):204===response.status||1223===response.status?request(path,shortData,cb,delayTimeout):linksWatcher&&clearInterval(linksWatcher)})},delay)}var delayTimeout=3e3,shortData=function(){var parsed=jsonUtils.parse(data);return jsonUtils.stringify({settings:parsed.settings,title:parsed.title,url:parsed.url})}();setTimeout(function(){delayTimeout=15e3},3e4),setTimeout(function(){delayTimeout=3e4},12e4),request(path,data,cb,delay)}function registerModules(){config.settings.features.indexOf(config.features.links)!==-1&&(modules.modlinks=new LinksModule),config.settings.features.indexOf(config.features.showcase)!==-1&&(modules.modshowcase=new ShowcaseModule),config.settings.features.indexOf(config.features.words)!==-1&&(modules.modwords=new WordsModule)}var options=_options_||{},initialized=!1,processingResults={},modules={},linksWatcher=null;this.isInitialized=function(){return initialized},this.init=function(){this.isInitialized()?utils.throwError(ERR_MSG_INIT):(initialized=!0,config.configure(options),registerModules(),dom.loadStylesheet(config.css.id,config.css.url),dom.onReady(run))},this.setOptions=function(_options_){this.isInitialized()?utils.throwError(ERR_MSG_INIT):utils.extend(options,_options_)},this.getOptions=function(){return options},this.getSettings=function(){return config.settings}}var ERR_MSG_INIT="Already initialized. You can setOptions only before initialization",Q=require("../libs/q.js"),config=require("./config"),utils=require("./utils/common"),browserUtils=require("./utils/browser"),http=require("./utils/http"),dom=require("./utils/dom"),extract=(require("./utils/text"),require("./utils/extract")),LinksModule=require("./modules/links"),WordsModule=require("./modules/words"),ShowcaseModule=require("./modules/showcase"),jsonUtils=require("./utils/json3"),userOptions=browserUtils.getWindow().ctxtconfig||null;if(browserUtils.getWindow().ConverText)utils.throwError(ERR_MSG_INIT);else{var converText=new ConverText(userOptions);module.exports=converText,browserUtils.getWindow().ConverText=converText,userOptions&&converText.init()}},{"../libs/q.js":1,"./config":3,"./modules/links":5,"./modules/showcase":6,"./modules/words":8,"./utils/browser":9,"./utils/common":10,"./utils/dom":12,"./utils/extract":13,"./utils/http":14,"./utils/json3":15,"./utils/text":17}],5:[function(require,module,exports){"use strict";function LinksModule(){function cookResponse(linksArray,deferred){var results={modlinks:[]},start=(new Date).getTime(),links=[].slice.call(linksArray),baseDomain=browserUtils.getDomain();utils.each(links,function(link){var domain=browserUtils.getDomain(link);anchorsWatched.push(link.href),hasIgnoredClass(link)||hasIgnoredDomains(domain)||!domain||textUtil.isContainText(baseDomain,domain)||textUtil.isContainText(domain,baseDomain)||(_registerListeners(link),_usableLinks.push(link),_usableLinksHrefs.push(link.href),results.modlinks.push(link.href),config.settings.debug&&domUtil.highlightNode(link,"link-node"))}),config.settings.debug===!0&&"console"in window&&"info"in window.console&&console.info("links: "+results.modlinks.length+" time: "+((new Date).getTime()-start)),deferred.resolve(results)}function _affiliateLinks(link){var indexes=getAllIndexes(_usableLinksHrefs,link.link);utils.isEmpty(indexes)||utils.each(indexes,function(idx){var url,node=_usableLinks[idx];_usableLinksHrefs[idx]=null,_apiLinks[link.link]={link:link.link,tracking_link:link.tracking_link},_wrappedTextLinks.length&&_wrappedLinksSpans[node.textContent]?(url=node.textContent,replaceSpan(_wrappedLinksSpans[url],url,link)):node.href===link.link&&(node.ctxtHref=link.tracking_link,domUtil.addClass(node,"ctxt-modlinks-link"),config.settings.debug&&domUtil.highlightNode(node,"affiliated-link","link-node"))})}function getAllIndexes(arr,val){var i,indexes=[];for(i=0;i<arr.length;i++)arr[i]===val&&indexes.push(i);return indexes}function hasIgnoredClass(node){var settings=config.settings.negative_cls;if(utils.isArray(settings)){for(var i=0;i<settings.length;i++)if(domUtil.hasClass(node,settings[i]))return!0}else if(utils.isString(settings))return domUtil.hasClass(node,settings)}function hasIgnoredDomains(domain){var settings=config.settings.ignore_domains;if(utils.isArray(settings))for(var i=0;i<settings.length;i++){if(settings[i].indexOf(domain)!==-1&&""!==settings[i])return!0;if(domain.indexOf(settings[i])!==-1&&""!==settings[i])return!0}else if(utils.isString(settings)&&""!==settings){if(settings.indexOf(domain)!==-1)return!0;if(domain.indexOf(settings)!==-1)return!0}}function replaceSpan(span,url,data){utils.each(browserUtils.getDocument().getElementsByTagName("span"),function(elem){if(elem&&elem.id===span.id){var parent=elem.parentNode;if(!domUtil.parents(elem,"A")){var link=_wrapUrlInLink(url);parent.replaceChild(link,elem),_registerListeners(link),link.href===data.link&&(link.ctxtHref=data.tracking_link,domUtil.addClass(link,"ctxt-modlinks-link"),config.settings.debug&&domUtil.highlightNode(link,"affiliated-link","link-node"))}}})}function clickHandler(eventObj,el){var target=eventObj?eventObj.target:el,targetAnchor=null;do{if(target&&("a"===target.tagName||target.ctxtHref)){targetAnchor=target;break}target=target.parentNode}while(target);if(targetAnchor){var originalHref=target.href;target.href=target.ctxtHref,setTimeout(function(){target.href=originalHref},150)}}function middleClick(e){2===e.which&&clickHandler(e)}function rightClick(e){3===e.which&&clickHandler(e)}function _registerListeners(link){domUtil.addEvent(link,"click",clickHandler),domUtil.addEvent(link,"contextmenu",rightClick,!0),domUtil.addEvent(link,"mousedown",middleClick,!0)}function dynamicClickHandler(event){event=event||window.event;var elem,el=event.target||event.srcElement,handler=function(event,el){var originalHref=el.href;utils.isEmpty(_apiLinks[originalHref])||el.ctxtHref||(el.ctxtHref=_apiLinks[originalHref].tracking_link,clickHandler(null,el),_registerListeners(el),config.settings.debug&&domUtil.highlightNode(el,"affiliated-link","link-node"))};el&&el.tagName&&("A"===el.tagName.toUpperCase()?handler(event,el):(elem=domUtil.parents(el,"A"))&&handler(event,elem))}function _extractTextNodes(nodesList,process,end){function nodesLoop(){for(var e=0;5>e&&nodes.length;e++){var node=nodes.shift();process(node)}nodes.length?setTimeout(nodesLoop,50):end()}var nodes=nodesList;nodesLoop()}function wrapTextLinks(extractedNodes,callback){function extractUrl(url,start,end,string){var isATag=string.substring(end-4,end+4);return"</a>"!==isATag&&url.indexOf("<")===-1&&url.indexOf(">")===-1&&url.indexOf("href")===-1&&(url.indexOf("[/url")!==-1&&(url=url.replace("[/url","")),url.indexOf("[/IMG")!==-1&&(url=url.replace("[/IMG","").replace("[/img","")),urls.push(url)),url}var urls=[],usableNodes=[];utils.each(extractedNodes,function(item){var parent=item.parentNode;usableNodes.indexOf(parent)===-1&&usableNodes.push(parent)}),_extractTextNodes(usableNodes,function(node){var textNodes,html=node.innerHTML,chunks=html.match(/.{1,512}/g);urls=[];for(var o=0;o<chunks.length;o++)chunks[o].indexOf("https://")===-1&&chunks[o].indexOf("http://")===-1&&chunks[o].indexOf("www.")===-1||textUtil.withinString(chunks[o],extractUrl);if(urls.length)for(var j=0;j<urls.length;j++){textNodes=domUtil.getTextNodes(node);for(var i=0;i<textNodes.length;i++){var nodeContent=textNodes[i].textContent;nodeContent.indexOf(urls[j])!==-1&&~textUtil.indexOfPhraseLatin(nodeContent,urls[j])&&(domUtil.parents(textNodes[i],["TEXTAREA","INPUT"])||wrapUrl(urls[j],textNodes[i]))}}},callback)}function wrapUrl(url,node){if(node.nodeType===Node.TEXT_NODE){var content=node.textContent,slicedContent=[],textLinks=[];_sliceTextContent(url,content,slicedContent,textLinks);for(var currNode=node,j=0;j<slicedContent.length;j++){var currText=slicedContent[j],wordNode=currNode;if(currNode.length>=currText.length&&(currNode=currNode.splitText(currText.length)),utils.isInArray(textLinks,j)&&!domUtil.parents(wordNode,"A")){var wrappedWord=_wrapUrlInSpan(currText);_wrappedLinksSpans[url]=wrappedWord,_wrappedTextLinks.push(_wrapUrlInLink(url)),node.parentNode.replaceChild(wrappedWord,wordNode)}}}}function _sliceTextContent(phrase,content,slicedContent,textLinks){var len=phrase.length,start=textUtil.indexOfPhraseLatin(content,phrase),end=start+len;0!==start&&slicedContent.push(content.slice(0,start)),slicedContent.push(content.slice(start,end)),textLinks.push(slicedContent.length-1);var last=content.slice(end);last&&(last.length>=len&&~textUtil.indexOfPhraseLatin(last,phrase)?_sliceTextContent(phrase,last,slicedContent,textLinks):slicedContent.push(last))}function _wrapUrlInSpan(url){var props={id:url};return domUtil.createElement("span",props,url)}function _wrapUrlInLink(url){var props={href:url,rel:"nofollow"};return domUtil.createElement("a",props,url)}var _usableLinks=[],_usableLinksHrefs=[],_wrappedTextLinks=[],_wrappedLinksSpans={},_apiLinks={},anchorsWatched=[];this.watcher=function(){var deferred=Q.defer(),extractedLinks=[].slice.call(extract.links()),filterLinks=[];return utils.each(extractedLinks,function(link){domUtil.hasClass(link,"ctxt-link")||domUtil.hasClass(link,"ctxt-suggestions-link")||domUtil.hasClass(link,"ctxt-affiliated-link")||domUtil.hasClass(link,"ctxt-showcase-link")||domUtil.hasClass(link,"ctxt-modlinks-link")||_usableLinksHrefs.indexOf(link.href)!==-1||anchorsWatched.indexOf(link.href)!==-1||filterLinks.push(link)}),filterLinks.length&&cookResponse(filterLinks,deferred),deferred.promise},this.processAnchors=function(){var deferred=Q.defer(),extractedLinks=[].slice.call(extract.links());return cookResponse(extractedLinks,deferred),deferred.promise},this.process=function(extractedNodes){var deferred=Q.defer();return wrapTextLinks(extractedNodes,function(){var links=[];_wrappedTextLinks.length&&(links=[].concat(_wrappedTextLinks)),cookResponse(links,deferred)}),deferred.promise},this.setUpAffiliation=function(response){var modlinks=response;if(!utils.isEmpty(modlinks)){for(var i=0;i<modlinks.length;i++)i<_usableLinks.length&&_affiliateLinks(modlinks[i]);var elements=config.getPositiveCls();utils.each(elements,function(element){domUtil.addEvent(element,"click",dynamicClickHandler),domUtil.addEvent(element,"mousedown",function(e){2===e.which&&dynamicClickHandler(e)},!0)})}return Q.resolve()}}var Q=require("../../libs/q.js"),config=require("../config"),utils=require("../utils/common"),browserUtils=require("../utils/browser"),domUtil=require("../utils/dom"),extract=require("../utils/extract"),textUtil=require("../utils/text");module.exports=LinksModule},{"../../libs/q.js":1,"../config":3,"../utils/browser":9,"../utils/common":10,"../utils/dom":12,"../utils/extract":13,"../utils/text":17}],6:[function(require,module,exports){"use strict";function ShowcaseModule(){function _by(v,w){return v.priority-w.priority}function handleResponse(data){isPlaceholder()&&(utils.each(data,function(word){utils.isEmpty(word.ctxtData)||!word.ctxtData.products||utils.isEmpty(word.ctxtData.products)||createProductModel(word.ctxtData.products)}),createWidget())}function getUniqueHash(hash){return nodeHashCount[hash]=nodeHashCount[hash]||0,nodeHashCount[hash]++,hash+"_"+nodeHashCount[hash]}function getHashContent(node){var hash,text=node.textContent,len=textUtil.trim(text.replace(/\s+/g," ")).length;return text=text.replace(/[:\s]*/g,""),hash=""+len+":"+text.substring(0,20),getUniqueHash(hash)}function createProductModel(products){utils.each(products,function(product){if(_productsNames.indexOf(product.name)===-1){var model=new ProductModel(product);_products.push(model),_productsNames.push(product.name)}})}function ProductModel(data){this.setData(data)}function createWidget(){if(!utils.isEmpty(_products))for(var placeholder=getPlaceholder(),i=0;i<placeholder.length;i++)createWidgetHtml(placeholder[i])}function createWidgetHtml(placeholder){var wrapper,productsHtml="";_products=sliceProducts(_products,placeholder),utils.each(_products,function(product){productsHtml+=tim(getProductTemplate(),{product:product,offers:createOffers(product.offers)})}),wrapper=createWrapper(productsHtml),placeholder.parentNode.replaceChild(wrapper,placeholder)}function createWrapper(products){var body,pref=settings.prefix,theme=pref+"-theme-"+config.settings.theme;return self.wrapper=domUtil.createElement("div",{id:pref,className:pref+"-table "+theme}),body=domUtil.createElement("div",{className:pref+"-table-body"}),body.innerHTML=products,self.wrapper.appendChild(body),self.wrapper}function getProductTemplate(){var tpl='<div class="ctxt-table-row"><a href="{{product.link}}" class="ctxt-showcase-link" target="_blank" rel="nofollow"><div class="ctxt-table-img"><img src="{{product.img}}" alt=""/></div><div class="ctxt-table-content"><div class="ctxt-table-arrow"><div class="ctxt-table-arrow-i">'+getIcon()+'</div></div><div class="ctxt-table-text-price">{{product.price}}</div><div class="ctxt-table-content-container"><div class="ctxt-table-title"><span class="ctxt-table-title-link">{{product.name}}</span></div><div class="ctxt-table-text">{{product.title}}</div></div></div></a>{{offers}}</div>';return tpl}function createOffers(offers){if(utils.isEmpty(offers)||1===offers.length)return"";for(var pref=settings.prefix,offersHtml='<div class="'+pref+'-table-collapsible"><div class="'+pref+'-table-collapsible-in">',i=0;i<offers.length;i++)offersHtml+=tim(getOfferTemplate(),offers[i]);return offersHtml+="</div></div>"}function getOfferTemplate(){var tpl='<div class="ctxt-table-shop {{even}}ctxt-even{{/even}}"><a href="{{links.tracking_link}}" class="ctxt-showcase-link" target="_blank" rel="nofollow"><div class="ctxt-table-shops-title"><span>{{merc}}</span></div><div class="ctxt-table-shops-price"><span>{{price}}</span></div><div class="ctxt-table-shops-arrow"><span>'+getIcon()+"</span></div></a></div>";return tpl}function getPlaceholder(){return document.querySelectorAll(settings.selector)}function isPlaceholder(){return!!getPlaceholder().length}function sliceProducts(products,placeholder){var elem=placeholder,data=elem.dataset;return data&&data.maxProducts?products.slice(0,parseInt(data.maxProducts,10)):products.slice(0,settings.max_products)}function getIcon(){var svg='<svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px  viewBox="0 0 98.148 98.148" fill="#eeeeee" xml:space=preserve><g><path d="M33.458,97.562L80.531,50.49c0.75-0.75,0.75-2.078,0-2.828L33.456,0.586C33.081,0.211,32.572,0,32.042,0c-0.53,0-1.039,0.211-1.414,0.586L17.641,13.573c-0.391,0.391-0.586,0.902-0.586,1.414c0,0.512,0.195,1.023,0.586,1.414l32.674,32.674L17.642,81.75c-0.751,0.75-0.75,2.078,0,2.828l12.987,12.984C31.411,98.344,32.677,98.344,33.458,97.562z"/></g></svg>';return svg}var self=this,_usableNodes=[],_productsNames=[],_products=[],nodeHashCount={};this.process=function(extractedNodes){function nodesExtractedLoop(){for(var e=0;100>e&&nodes.length;e++){var node=nodes.shift(),parent=node.parentNode;if(null!==parent){var hash=getHashContent(parent);_usableNodes[hash]=parent,results.modshowcase.nodes[hash]=extract.extractUsableInfoFromNode(node)}}nodes.length?setTimeout(nodesExtractedLoop,10):(utils.each(extract.headers(),function(node){results.modshowcase.headers.push(extract.extractUsableInfoFromNode(node))}),deferred.resolve(results))}var deferred=Q.defer(),results={modshowcase:{nodes:{},headers:[]}};if(!isPlaceholder())return Q.resolve(results);var nodes=[].concat(extractedNodes);return nodesExtractedLoop(),deferred.promise},this.setUpAffiliation=function(httpResponse){var modshowcase=httpResponse.modshowcase;return utils.isEmpty(modshowcase)||(sort(modshowcase,_by),handleResponse(modshowcase)),Q.resolve()},ProductModel.prototype.setData=function(data){if(!utils.isEmpty(data.offers)&&data.offers[0]&&data.offers[0].price?this.price=data.offers[0].price:this.price="",!utils.isEmpty(data.offers)&&data.offers[0]&&data.offers[0].links.tracking_link?this.link=data.offers[0].links.tracking_link:this.link="",!utils.isEmpty(data.offers))for(var i=0;i<data.offers.length;i++)data.offers[i].even=(i+1)%2===0;utils.extend(this,data)}}var Q=require("../../libs/q.js"),config=require("../config"),settings=config.modulesSettings.showCase,utils=require("../utils/common"),domUtil=require("../utils/dom"),sort=require("../utils/sort"),extract=require("../utils/extract"),tim=require("../../libs/tim.js"),textUtil=require("../utils/text");module.exports=ShowcaseModule},{"../../libs/q.js":1,"../../libs/tim.js":2,"../config":3,"../utils/common":10,"../utils/dom":12,"../utils/extract":13,"../utils/sort":16,"../utils/text":17}],7:[function(require,module,exports){"use strict";function SuggestionsModule(){function genOffers(prod,multi){var _offer="";return multi?_offer+=tim(OFFERS,utils.extend({pref:pref,multi:multi},prod.offers[0],prod)):utils.each(prod.offers,function(offer){_offer+=tim(OFFERS,utils.extend({pref:pref,multi:multi},offer,prod))}),_offer}function genProducts(ctxtData){var _products="",prods=ctxtData.products,multi=prods&&prods.length>1;if(multi)utils.each(prods,function(prod){var _offer=genOffers(prod,multi);_products+=tim(PRODUCT,utils.extend({pref:pref,link:prod.offers&&prod.offers[0]&&prod.offers[0].links.tracking_link||ctxtData.links.tracking_link,offer:_offer},prod))});else{var _offers=genOffers(prods[0],multi),_product=tim(PRODUCT,utils.extend({pref:pref,link:prods[0].offers&&prods[0].offers[0]&&prods[0].offers[0].links.tracking_link||ctxtData.links.tracking_link,offer:""},prods[0]));_products+=tim(PRODUCTS,{offer:_offers,product:_product})}return _products}var self=this;self.containerTimeoutHandler=null,self.container=null,self.getThemeClass=function(){return pref+"-theme-"+config.settings.theme},self.generate=function(ctxtData,container){var products=ctxtData.products,multi=products&&products.length>1,_up=tim(POINTER,{pref:pref,side:"up"}),_down=tim(POINTER,{pref:pref,side:"down"}),_search=ctxtData.search&&ctxtData.search!=={}?tim(SEARCH,utils.extend(ctxtData.search,{pref:pref})):"",_products=genProducts(ctxtData),_body=tim(BODY,{pref:pref,search:_search,products:_products}),_wrapper=tim(WRAPPER,{pref:pref,up:_up,body:_body,down:_down,multi:multi});return container.innerHTML=_wrapper,domUtil.addEvent(container.getElementsByClassName(pref+"-close")[0],"click",function(){self.container.mouseEntered=!1,self.hide()}),container},self.init=function(){var attributes={id:pref,className:pref+"-box "+self.getThemeClass()};self.container=domUtil.createElement("div",attributes),utils.extend(self.container.style,{position:"absolute",display:"none",zIndex:domUtil.topZindex()+10}),browserUtils.getDocument().body.appendChild(self.container),domUtil.addEvent(self.container,"mouseenter",function(){self.container.mouseEntered=!0}),domUtil.addEvent(self.container,"mouseleave",function(){self.container.mouseEntered=!1,self.hide()})},self.create=function(linkElement,ctxtData){var mouseHover=!1,flyoverInitialized=!1;utils.each(ctxtData.products,function(prod){var img=new Image;img.src=prod.img}),domUtil.addEvent(linkElement,"mouseenter",function(eventObject){ctxtData.disable_widget||(mouseHover=!0,flyoverInitialized?self.display(linkElement,eventObject):(flyoverInitialized=!0,linkElement.ctxtData=ctxtData,mouseHover&&self.display(linkElement,eventObject)))}),domUtil.addEvent(linkElement,"mouseleave",function(eventObject){ctxtData.disable_widget||(mouseHover=!1,self.hide())})},self.display=function(linkElement,eventObject){if(linkElement.ctxtData){clearTimeout(self.containerTimeoutHandler);var flyoverDiv=self.container;domUtil.removeChildren(flyoverDiv),self.generate(linkElement.ctxtData,flyoverDiv);for(var linkElementsList=flyoverDiv.getElementsByTagName("a"),idx=0;idx<linkElementsList.length;idx++){var linkElement2=linkElementsList[idx];browserUtils.getDomain(linkElement2)===browserUtils.getDomain(linkElement)&&(utils.extend(linkElement2,{target:linkElement.target}),linkElement2.lin_metadata=linkElement.lin_metadata)}flyoverDiv.style.visibility="hidden",flyoverDiv.style.display="block",flyoverDiv.style.height="";var flyoverBody=flyoverDiv.getElementsByClassName(pref+"-products")[0],docElem=browserUtils.getDocument().documentElement,linkOffset=domUtil.offset(linkElement),top=linkOffset.top,c=top-flyoverDiv.offsetHeight;c<0&&(c=top+linkElement.offsetHeight);var scrollLeft=docElem.scrollLeft,f=scrollLeft+docElem.clientWidth-flyoverDiv.offsetWidth,cssProps={left:Math.min(Math.max(scrollLeft,eventObject.pageX-flyoverDiv.offsetWidth/2),f)+"px",top:c+"px"};utils.extend(flyoverDiv.style,cssProps);var currentTop,finalTop,directionDown=linkOffset.top>flyoverDiv.offsetHeight&&flyoverDiv.getBoundingClientRect().bottom>=flyoverDiv.offsetHeight,flyoverPointer=null;directionDown?(flyoverPointer=flyoverDiv.getElementsByClassName(pref+"-down-pointer")[0],flyoverDiv.getElementsByClassName(pref+"-up-pointer")[0].style.display="none"):(flyoverPointer=flyoverDiv.getElementsByClassName(pref+"-up-pointer")[0],flyoverDiv.getElementsByClassName(pref+"-down-pointer")[0].style.display="none",c=top+linkElement.offsetHeight,finalTop=currentTop=c),flyoverPointer.style.display="block",flyoverPointer.style.left=flyoverDiv.offsetWidth/2-flyoverPointer.offsetWidth/2+"px",flyoverDiv.style.top=c+"px";var effect="fadeIn";if("collapse"===effect){var currentHeight=12,finalHeight=flyoverBody.offsetHeight;currentTop=c+finalHeight-currentHeight,finalTop=c,flyoverBody.style.height=currentHeight+"px",flyoverDiv.style.top=currentTop+"px",flyoverDiv.style.visibility="",self.expand(flyoverBody,currentHeight,finalHeight,flyoverDiv,currentTop,finalTop,directionDown)}if("fadeIn"===effect){var currentOpacity=.1;flyoverDiv.style.opacity=currentOpacity+"",flyoverDiv.style.visibility="",self.fadeIn(flyoverDiv,currentOpacity)}}},self.expand=function(flyoverBody,currentHeight,finalHeight,flyoverDiv,currentTop,finalTop,directionDown){currentHeight<finalHeight?(flyoverBody.style.height=currentHeight+"px",directionDown&&(flyoverDiv.style.top=currentTop+"px"),self.fadeInTimeoutHandler=setTimeout(function(){self.expand(flyoverBody,currentHeight+5,finalHeight,flyoverDiv,currentTop,finalTop,directionDown)},5)):(flyoverBody.style.height="",flyoverDiv.style.top=finalTop+"px")},self.fadeIn=function(flyoverDiv,currentOpacity){currentOpacity<1?(flyoverDiv.style.opacity=currentOpacity+"",self.fadeInTimeoutHandler=setTimeout(function(){self.fadeIn(flyoverDiv,currentOpacity+.1)},10)):flyoverDiv.style.opacity="1.0"},self.hide=function(){clearTimeout(self.containerTimeoutHandler),self.containerTimeoutHandler=setTimeout(function(){self.container.mouseEntered||domUtil.hide(self.container)},settings.hDelay)}}var config=require("../config"),settings=config.modulesSettings.suggestions,utils=require("../utils/common"),browserUtils=require("../utils/browser"),domUtil=(require("../utils/http"),require("../utils/dom")),tim=require("../../libs/tim.js"),pref=settings.prefix,WRAPPER='{{up}}<div class="{{pref}}-content {{multi}}{{pref}}-multi{{/multi}}">{{body}}<div class="{{pref}}-bottom"><a href="//convertiser.com/pl/?utm_source=convertext&utm_medium=convertext&utm_campaign=convertext" target="_blank" class="{{pref}}-bottom-link {{pref}}-suggestions-link" rel="nofollow"> Convertiser</a></div></div>{{down}}',POINTER='<div class="{{pref}}-pointer {{pref}}-{{side}}-pointer"></div>',BODY='<div class="{{pref}}-products">{{products}}{{search}}</div>',PRODUCT='<div class="{{pref}}-row {{pref}}-product"><div class="{{pref}}-close {{pref}}-widthless"></div><a class="{{pref}}-img {{pref}}-suggestions-link" href="{{link}}" target="_blank" rel="nofollow"><img src="{{img}}" title="{{title}}"></a><a class="{{pref}}-link {{pref}}-suggestions-link" href="{{link}}" target="_blank" rel="nofollow">{{name}}<span class="{{pref}}-description">{{title}}</span></a>{{offer}}</div>',PRODUCTS="{{product}}{{offer}}",OFFERS='<div class="{{pref}}-row {{pref}}-offer {{multi}}{{pref}}-multi{{/multi}}"><div class="{{pref}}-merc"><a href="{{links.tracking_link}}" class="{{pref}}-suggestions-link" target="_blank" rel="nofollow">{{merc}}</a></div><div class="{{pref}}-price"><a href="{{links.tracking_link}}" class="{{pref}}-suggestions-link" target="_blank" rel="nofollow">{{price}}</a></div><a class="{{pref}}-arrow" class="{{pref}}-suggestions-link" href="{{links.tracking_link}}" target="_blank" rel="nofollow"><br></a></div>',SEARCH='<div class="{{pref}}-row {{pref}}-search"><a href="{{link}}" target="_blank" rel="nofollow" class="{{pref}}-suggestions-link"><span class="{{pref}}-loupe-top"></span><div class="{{pref}}-loupe-bottom">-</div>{{text}}</a></div>';module.exports=SuggestionsModule},{"../../libs/tim.js":2,"../config":3,"../utils/browser":9,"../utils/common":10,"../utils/dom":12,"../utils/http":14}],8:[function(require,module,exports){"use strict";function WordsModule(){function extractTextNodes(modwords,process,end){function nodesLoop(){for(var e=0;5>e&&nodes.length;e++){var node=nodes.shift();spans=spans.concat(process(node,modwords))}nodes.length?setTimeout(nodesLoop,50):end(spans)}for(var spans=[],nodes=[],j=0;j<modwords.length;j++)if(modwords[j].nodes&&modwords[j].nodes.length)for(var k=0;k<modwords[j].nodes.length;k++){var n=modwords[j].nodes[k];_usableNodes[n]&&nodes.indexOf(_usableNodes[n])===-1&&nodes.push(_usableNodes[n])}nodesLoop()}function nodeFn(node,modwords){for(var word,textNodes,spans=[],i=0;i<modwords.length;i++){word=modwords[i].word,textNodes=domUtil.getTextNodes(node);for(var j=0;j<textNodes.length;j++){var nodeContent=textNodes[j].textContent;nodeContent.indexOf(word)!==-1&&(domUtil.hasClass(textNodes[j].parentNode,domUtil.getPrefixedClass("reserved-node"))||domUtil.parents(textNodes[j],"A")||textUtil.isContainPhrase(nodeContent,word)&&(spans=spans.concat(wrapPhraseInSpan(word,textNodes[j],modwords[i].ctxtData,modwords[i].priority))))}}return spans}function wrapPhraseInSpan(phrase,node,ctxtData,priority){var spans=[];if(node.nodeType!==Node.TEXT_NODE)return spans;var content=node.textContent,slicedContent=[],widgets=[];_sliceTextContent(phrase,content,slicedContent,widgets);for(var currNode=node,i=0;i<slicedContent.length;i++){var currText=slicedContent[i],wordNode=currNode;if(currNode.length>=currText.length&&(currNode=currNode.splitText(currText.length)),utils.isInArray(widgets,i)&&null!==node.parentNode){var wrappedWord=_wrapWord(currText,ctxtData);node.parentNode.replaceChild(wrappedWord,wordNode);var area=domUtil.elementArea(wrappedWord);spans.push({phrase:phrase,span:wrappedWord,area:area,isUrl:textUtil.isItUrl(phrase),ctxtData:ctxtData,priority:priority})}}return spans}function freePosition(spans){var output=[];return sort(spans,function(v,w){return v.priority-w.priority}),utils.each(spans,function(span){var freeArea=utils.isFreeArea(areaAround(span.area,settings.verDist,settings.horDist),_usedAreas),freeAreaPhrase=utils.isFreeArea(areaAroundPhrase(span.area),_usedAreasPhrase[span.phrase]||[]);(span.isUrl||freeArea&&freeAreaPhrase)&&(span.isUrl||(_usedAreas.push(span.usedArea=areaAround(span.area,settings.verDist,settings.horDist)),_usedAreasPhrase[span.phrase]?_usedAreasPhrase[span.phrase].push(areaAroundPhrase(span.area)):_usedAreasPhrase[span.phrase]=[areaAroundPhrase(span.area)]),span.usedArea&&showArea(span.usedArea),output.push(span))}),output}function frequencyPhrase(spans,filteredSpans){function group(group,source){utils.each(source,function(span){span.isUrl||(group[span.phrase]?group[span.phrase].push(span):group[span.phrase]=[span])})}function compare(num){function fn(number){for(var phrase in groupedPhraseFiltered){var per=groupedPhraseFiltered[phrase].length/groupedPhrase[phrase].length*100;if(groupedPhraseFiltered[phrase].length>1&&per>number)return groupedPhraseFiltered[phrase]=groupedPhraseFiltered[phrase].slice(1),array=[],fn(number);array=array.concat(groupedPhraseFiltered[phrase])}}var array=[];return fn(num),array}var output=[],groupedPhrase={},groupedPhraseFiltered={};return"maximum"===settings.frequency?filteredSpans:(group(groupedPhrase,spans),group(groupedPhraseFiltered,filteredSpans),output="optimum"===settings.frequency?output.concat(compare(60)):"minimum"===settings.frequency?output.concat(compare(50)):output.concat(compare(50)))}function widgetsLinksRatio(spans){var extraElem,wrappedWords=spans,shuffled=[],divided=[],output=[];return.5===config.settings.link_density&&wrappedWords.length%2!==0&&(extraElem=wrappedWords.shift()),shuffled=shuffleLinks(wrappedWords),divided=divide.ratio(shuffled,config.settings.link_density),extraElem&&divided[Math.round(Math.random())].push(extraElem),output.concat(disableWidgets(divided[0]),divided[1]||[])}function shuffleLinks(links){return utils.shuffle(links)}function disableWidgets(links){for(var i=0;i<links.length;i++)links[i].ctxtData.disable_widget=!0;return links}function _by(v,w){return v.priority-w.priority}function getUniqueHash(hash){return nodeHashCount[hash]=nodeHashCount[hash]||0,nodeHashCount[hash]++,hash+"_"+nodeHashCount[hash]}function getHashContent(node){var hash,text=node.textContent,len=textUtil.trim(text.replace(/\s+/g," ")).length;return text=text.replace(/[:\s]*/g,""),hash=""+len+":"+text.substring(0,20),getUniqueHash(hash)}function areaAround(nodeArea,verDist,horDist){
var area={top:nodeArea.top-verDist,left:nodeArea.left-horDist,height:nodeArea.height+2*verDist,width:nodeArea.width+2*horDist};return area.bottom=area.top+area.height,area.right=area.left+area.width,area}function areaAroundPhrase(nodeArea){return areaAround(nodeArea,settings.verDistSamePhrase,settings.horDistSamePhrase)}function showArea(area,className){config.settings.debug&&_showAreaAround(area,className)}function _showAreaAround(area,className){var style=["top: "+area.top+"px;","left: "+area.left+"px;","height: "+area.height+"px;","width: "+area.width+"px;"],div=document.createElement("div");div.setAttribute("style",style.join(" ")),div.setAttribute("class",domUtil.getPrefixedClass(className||"reserved-area")),document.body.appendChild(div)}function _wrapWord(phrase,ctxtData){var span=document.createElement("span");return config.settings.debug&&span.setAttribute("class",domUtil.getPrefixedClass("phrase-node")),span.setAttribute("class",domUtil.getPrefixedClass("reserved-node")),span.appendChild(document.createTextNode(phrase)),span.ctxtData=ctxtData,span}function _sliceTextContent(phrase,content,slicedContent,widgets){var len=phrase.length,start=textUtil.indexOfPhrase(content,phrase),end=start+len;0!==start&&slicedContent.push(content.slice(0,start)),slicedContent.push(content.slice(start,end)),widgets.push(slicedContent.length-1);var last=content.slice(end);last&&(last.length>=len&&textUtil.isContainPhrase(last,phrase)?_sliceTextContent(phrase,last,slicedContent,widgets):slicedContent.push(last))}function createWidgetLink(phrase,ctxtData){var props={feature:config.features.words,target:"_blank",className:settings.linkClass,href:ctxtData.links.link||"#",ctxtHref:ctxtData.links.tracking_link,rel:"nofollow"},linkElement=domUtil.createElement("a",props,phrase);return linkElement.setAttribute("ctxttrackinglink",ctxtData.links.tracking_link),config.settings.debug&&domUtil.css(linkElement,{position:"relative",zIndex:2}),domUtil.addEvent(linkElement,"click",clickHandler),domUtil.addEvent(linkElement,"contextmenu",rightClick,!0),domUtil.addEvent(linkElement,"mousedown",middleClick,!0),ctxtData.products&&config.settings.widget&&SuggestionsModule.create(linkElement,ctxtData),linkElement}function clickHandler(eventObj){var target=eventObj.target,targetAnchor=null;do{if(target&&("a"===target.tagName||target.ctxtHref)){targetAnchor=target;break}target=target.parentNode}while(target);if(targetAnchor){var originalHref=target.href;target.href=target.ctxtHref,target.target="_blank",setTimeout(function(){target.href=originalHref},150)}}function middleClick(e){2===e.which&&clickHandler(e)}function rightClick(e){3===e.which&&clickHandler(e)}var _usableTextNodes,_usableNodes={},_usedAreas=[],_usedAreasPhrase={},_widgetLinks=[],nodeHashCount={};this.process=function(extractedNodes){function nodesExtractedLoop(){for(var e=0;100>e&&nodes.length;e++){var node=nodes.shift(),parent=node.parentNode;if(null!==parent){var hash=getHashContent(parent);_usableNodes[hash]=parent,results.modwords.nodes[hash]=extract.extractUsableInfoFromNode(node),config.settings.debug&&domUtil.highlightTextNode(parent,"text-node")}}nodes.length?setTimeout(nodesExtractedLoop,10):(utils.each(extract.headers(),function(node){results.modwords.headers.push(extract.extractUsableInfoFromNode(node))}),deferred.resolve(results))}var deferred=Q.defer();_usableTextNodes=extractedNodes;var results={modwords:{nodes:{},headers:[]}},nodes=_usableTextNodes;return nodesExtractedLoop(),deferred.promise},this.setUpAffiliation=function(httpResponse){var deferred=Q.defer(),modwords=httpResponse.modwords;if(utils.isEmpty(modwords))deferred.resolve();else{sort(modwords,_by),SuggestionsModule.init();var start=(new Date).getTime();extractTextNodes(modwords,nodeFn,function(spans){var filteredSpans=[];filteredSpans=frequencyPhrase(spans,spans),filteredSpans=freePosition(filteredSpans),filteredSpans=widgetsLinksRatio(filteredSpans),utils.each(filteredSpans,function(span){if(span){var widgetLink=createWidgetLink(span.phrase,span.ctxtData);span.span.replaceChild(widgetLink,span.span.firstChild),_widgetLinks.push(widgetLink),config.settings.debug&&domUtil.highlightNode(span.span,"affiliated-phrase","phrase-node")}}),config.settings.debug===!0&&"console"in window&&"info"in window.console&&console.info("words: "+modwords.length+" time: "+((new Date).getTime()-start)),deferred.resolve()})}return deferred.promise}}var Q=require("../../libs/q.js"),config=require("../config"),settings=config.modulesSettings.words,utils=require("../utils/common"),domUtil=require("../utils/dom"),textUtil=require("../utils/text"),sort=(require("../utils/browser"),require("../utils/sort")),SuggestionsModule=new(require("./suggestions")),extract=require("../utils/extract"),divide=require("../utils/divide");module.exports=WordsModule},{"../../libs/q.js":1,"../config":3,"../utils/browser":9,"../utils/common":10,"../utils/divide":11,"../utils/dom":12,"../utils/extract":13,"../utils/sort":16,"../utils/text":17,"./suggestions":7}],9:[function(require,module,exports){"use strict";var userAgent=navigator.userAgent.toLowerCase();userAgent=/(webkit)[ \/]([\w.]+)/.exec(userAgent)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(userAgent)||/(msie) ([\w.]+)/.exec(userAgent)||0>userAgent.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(userAgent)||[];var DOCUMENT_INSTANCE=document,WINDOW_INSTANCE=window;module.exports={getWindow:function(){return WINDOW_INSTANCE},getDocument:function(){return DOCUMENT_INSTANCE},protocol:function(){return this.getDocument().location.protocol},getDomain:function(anchor){return anchor=anchor||this.getDocument().location,anchor.hostname.toLowerCase().replace(/^www\./,"")},browser:function(){return userAgent[1]||""},version:function(){return parseFloat(userAgent[2])||0}}},{}],10:[function(require,module,exports){"use strict";var BREAKER={};module.exports={isArray:function(v){return Array.isArray?Array.isArray(v):"[object Array]"===Object.toString(v)},isEmpty:function(v){if(!v)return!0;if(this.isArray(v)||this.isString(v))return 0===v.length;for(var prop in v)if(v.hasOwnProperty(prop))return!1;return!0},getKeys:function(v){if(Object.keys)return Object.keys(v);var keys=[];for(var prop in v)v.hasOwnProperty(prop)&&keys.push(prop);return keys},indexOf:function(needle){var indexOf;return indexOf="function"==typeof Array.prototype.indexOf?Array.prototype.indexOf:function(needle){for(var index=-1,i=0;i<this.length;i++)if(this[i]===needle){index=i;break}return index},indexOf.call(this,needle)},each:function(obj,cb,item){var i,length;if(null!==obj){var nativeForEach=Array.prototype.forEach;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(cb,item);else if(obj.length===+obj.length){for(i=0,length=obj.length;i<length;i++)if(cb.call(item,obj[i],i,obj)===BREAKER)return}else{var keys=this.getKeys(obj);for(i=0,length=keys.length;i<length;i++)if(cb.call(item,obj[keys[i]],keys[i],obj)===BREAKER)return}}},extend:function(obj){obj=obj||{};var args=Array.prototype.slice.call(arguments).slice(1);return this.each(args,function(source){if(source)for(var prop in source)source.hasOwnProperty(prop)&&(obj[prop]=source[prop])}),obj},throwError:function(msg){var msg=this.isPlainObject(msg)?this.objToString(msg):msg;throw new Error("Convertiser: "+msg)},isFunction:function(v){return v&&"[object Function]"==={}.toString.call(v)},isRectIntersect:function(usedArea,newArea){return!(newArea.left>usedArea.right||newArea.right<usedArea.left||newArea.top>usedArea.bottom||newArea.bottom<usedArea.top)},isFreeArea:function(area,usedAreas){for(var i=0;i<usedAreas.length;i++)if(this.isRectIntersect(usedAreas[i],area))return!1;return!0},getArea:function(area,usedAreas){for(var i=0;i<usedAreas.length;i++)if(this.isRectIntersect(usedAreas[i],area))return{index:i,area:usedAreas[i]}},isInArray:function(array,item){return~this.indexOf.call(array,item)},snapshotsToNodes:function(ss){for(var nodes=[],i=0;i<ss.snapshotLength;i++)nodes.push(ss.snapshotItem(i));return nodes},shuffle:function(array){for(var temp,index,counter=array.length;counter>0;)index=Math.floor(Math.random()*counter),counter--,temp=array[counter],array[counter]=array[index],array[index]=temp;return array},isString:function(value){var toString=Object.prototype.toString;return"string"==typeof value||value&&"object"==typeof value&&"[object String]"===toString.call(value)||!1},isUndefined:function(value){return"undefined"==typeof value},objToString:function(obj){var str="";for(var p in obj)obj.hasOwnProperty(p)&&(str+=p+"::"+obj[p]+"\n");return str},isPlainObject:function(obj){if(!obj||"[object Object]"!==toString.call(obj)||obj.nodeType||obj.setInterval)return!1;if(obj.constructor&&!hasOwnProperty.call(obj,"constructor")&&!hasOwnProperty.call(obj.constructor.prototype,"isPrototypeOf"))return!1;var key;for(key in obj);return void 0===key||hasOwnProperty.call(obj,key)}}},{}],11:[function(require,module,exports){"use strict";function shuffleString(str){for(var str=str.split(""),n=str.length,i=n-1;i>0;i--){var j=Math.floor(Math.random()*(i+1)),tmp=str[i];str[i]=str[j],str[j]=tmp}return str.join("")}function shuffle(o){if(o.constructor===String)return shuffleString.call(null,o);for(var j,x,i=o.length;i;j=Math.floor(Math.random()*i),x=o[--i],o[i]=o[j],o[j]=x);return o}var sum=function(a,b){return a+b};module.exports={ratio:function(arr){var args=[].slice.call(arguments,1),total=0;return 1===args.length&&args.push(1-args[0]),args.reduce(sum)>1?console.log("The sum of the ratios entered should equal to 1."):args.map(function(value){var start=~~(total*arr.length),end=~~((value+total)*arr.length);return total+=value,arr.slice(start,end)})},random:function(arr){return this.ratio.apply(null,[shuffle(arr)].concat([].slice.call(arguments,1)))}}},{}],12:[function(require,module,exports){"use strict";var utils=require("./common"),textUtils=require("./text"),browserUtils=require("./browser"),config=require("../config");module.exports={onReady:function(cb){var done=!1,top=!0,root=browserUtils.getDocument().documentElement,add=browserUtils.getDocument().addEventListener?"addEventListener":"attachEvent",rem=browserUtils.getDocument().addEventListener?"removeEventListener":"detachEvent",pre=browserUtils.getDocument().addEventListener?"":"on",init=function(e){"readystatechange"===e.type&&"complete"!==browserUtils.getDocument().readyState||(("load"===e.type?browserUtils.getWindow():browserUtils.getDocument())[rem](pre+e.type,init,!1),!done&&(done=!0)&&cb.call(browserUtils.getWindow(),e.type||e))},poll=function(){try{root.doScroll("left")}catch(e){return void setTimeout(poll,50)}init("poll")};if("complete"===browserUtils.getDocument().readyState)cb.call(browserUtils.getWindow(),"lazy");else{if(browserUtils.getDocument().createEventObject&&root.doScroll){try{top=!browserUtils.getWindow().frameElement}catch(e){}top&&poll()}browserUtils.getWindow().__cfRocketOptions?setTimeout(function(){cb.call(browserUtils.getWindow(),{})},2e3):(browserUtils.getDocument()[add](pre+"DOMContentLoaded",init,!1),browserUtils.getDocument()[add](pre+"readystatechange",init,!1),browserUtils.getWindow()[add](pre+"load",init,!1))}},removeClass:function(elem,cn){elem.className&&(elem.className=elem.className.replace(new RegExp("(?:^|\\s)"+cn+"(?!\\S)"),""))},addClass:function(elem,cn){var classRegExp=new RegExp("\\b"+textUtils.escapeStr(cn)+"\\b");classRegExp.test(elem.className)||(elem.className+=" "+cn)},removeChildren:function(n){for(var fc=n.firstChild;fc;)n.removeChild(fc),fc=n.firstChild},addEvent:function(elem,event,cb,param){elem.addEventListener?elem.addEventListener(event,cb,param||!1):elem.attachEvent&&(elem["e"+event+cb]=cb,elem[event+cb]=function(){elem["e"+event+cb](window.event)},elem.attachEvent("on"+event,elem[event+cb]))},removeEvent:function(elem,event,cb){elem.removeEventListener?elem.removeEventListener(event,cb,!1):elem.detachEvent&&(elem.detachEvent("on"+event,elem[event+cb]),elem[event+cb]=null,elem["e"+event+cb]=null)},css:function(elem,props){utils.extend(elem.style,props)},createElement:function(type,attrs,text){var element=browserUtils.getDocument().createElement(type);return attrs&&utils.extend(element,attrs),text&&this.appendTextTo(element,text),element},createDiv:function(cn){return this.createElement("div",{className:cn})},show:function(elem){elem.style.display="block"},hide:function(element){element.style.display="none"},appendToTag:function(child,tag){var node=browserUtils.getDocument().getElementsByTagName(tag)[0];return!!node&&(node.appendChild(child),!0)},appendTextTo:function(elem,text){elem.appendChild(browserUtils.getDocument().createTextNode(text))},loadStylesheet:function(id,href){if(!browserUtils.getDocument().getElementById(id)){var link=this.createElement("link",{id:id,rel:"stylesheet",href:href});this.appendToTag(link,"head")||this.appendToTag(link,"body")}},loadScript:function(id,src,cb){if(!browserUtils.getDocument().getElementById(id)){var script=this.createElement("script",{type:"text/javascript",async:!1,charset:"utf-8",id:id,src:src,onload:cb||function(){}});this.appendToTag(script,"head")||this.appendToTag(script,"body")}},offset:function(elem){var docElem,win,box={top:0,left:0},doc=browserUtils.getDocument();if(doc)return docElem=doc.documentElement,box=elem.getBoundingClientRect(),win=browserUtils.getWindow(),{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}},elementArea:function(elem){function getOffset(elem){var offset=self.offset(elem);return{top:Math.round(offset.top),left:Math.round(offset.left)}}var self=this,area={top:getOffset(elem).top,left:getOffset(elem).left,height:elem.offsetHeight,width:elem.offsetWidth};return area.bottom=area.top+area.height,area.right=area.left+area.width,area},getPrefixedClass:function(cn){return config.modulesSettings.suggestions.prefix+"-"+cn},highlightNode:function(elem,newClass,oldClass){oldClass&&this.removeClass(elem,this.getPrefixedClass(oldClass)),this.addClass(elem,this.getPrefixedClass(newClass))},highlightTextNode:function(parent,cn){this.addClass(parent,this.getPrefixedClass(cn))},isElementVisible:function(elem){var style=getComputedStyle(elem);return"visible"===style.visibility&&"none"!==style.display},parents:function(el,tag){for(;el.parentNode;)if(el=el.parentNode,utils.isArray(tag)){if(el.tagName&&tag.indexOf(el.tagName.toUpperCase())!==-1)return el}else if(el.tagName&&el.tagName===tag)return el;return null},topZindex:function(){var doc=browserUtils.getDocument(),elems=doc.getElementsByTagName("*"),values=[];return elems.length?(utils.each(elems,function(item){var zindex=browserUtils.getWindow().getComputedStyle(item,null).getPropertyValue("z-index");"undefined"!=typeof zindex&&"auto"!==zindex&&values.push(parseFloat(zindex)||null)}),Math.max(0,Math.max.apply(null,values))):null},hasClass:function(elem,className){if(!elem)return!0;var prop=elem.className;return prop.replace(/[\n\t\r]/g," ").indexOf(className)>-1},getTextNodes:function(node,cb){function walkTheDOM(node,func){for(func(node),node=node.firstChild;node;)walkTheDOM(node,func),node=node.nextSibling}function pushText(currentNode){3===currentNode.nodeType&&(cb&&cb(currentNode),arrayOfText.push(currentNode))}var arrayOfText=[];return walkTheDOM(node,pushText),arrayOfText}}},{"../config":3,"./browser":9,"./common":10,"./text":17}],13:[function(require,module,exports){"use strict";var browserUtils=require("./browser"),config=require("../config"),_document_=browserUtils.getDocument(),settings=require("../config").settings,domUtil=require("./dom"),textUtil=require("./text"),utils=require("./common"),TAG_NAMES_TO_IGNORE={TEXTAREA:1,STYLE:1,NOSCRIPT:1,SCRIPT:1,IMG:1,AREA:1,MAP:1,OBJECT:1,PARAM:1,IFRAME:1,HEADER:1,FOOTER:1,NAV:1,AUDIO:1,EMBED:1,SOURCE:1,TRACK:1,VIDEO:1,MENUITEM:1,ASIDE:1,CANVAS:1,OPTION:1,A:1,SVG:1,INPUT:1,BUTTON:1,SELECT:1,META:1,LINK:1,LABEL:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,BR:1},TEXT_DECORATOR_TAGS={B:1,BIG:1,EM:1,I:1,SMALL:1,STRONG:1,SUB:1,SUP:1,INS:1,DEL:1,MARK:1,Q:1,FONT:1,U:1,STRIKE:1,ACRONYM:1},PATTERN_TO_IGNORE=/(header|footer|sidebar|banner|advert|google|adsense|sponsor|adsence|ad_cont|copyright|policy|cookie)+/,extractedHeaders=[];module.exports={usableTextNodes:function(callback){function processTextNodes(node){var wordsCount,textContent=node.textContent,cleanText=textUtil.clearText(textContent);if(!(cleanText.length<2||textUtil.isNodeWhitespace(node))){if(wordsCount=textUtil.wordsCounter(cleanText),node.inside_decorator_tag){if(wordsCount<1)return}else if(wordsCount<2)return;textNodes.push(node)}}function processElemNodes(node){var tagName=node.tagName;if(TEXT_DECORATOR_TAGS[tagName.toUpperCase()])for(var c=0,l=node.childNodes.length;l>c;c++)node.childNodes[c].nodeType===Node.TEXT_NODE&&(node.childNodes[c].inside_decorator_tag=!0)}function processOtherElemNodes(node,tagName){extractedHeaders.push(node)}function isHeader(tagName){var headers=["H1","H2","H3","H4","H5","H6"];return tagName&&headers.indexOf(tagName.toUpperCase())!==-1}function isAllowed(node,tagName){if(!tagName||TAG_NAMES_TO_IGNORE[tagName.toUpperCase()])return!1;if(tagName&&"BODY"===tagName.toUpperCase())return!0;var className=node.getAttribute("class"),id=node.getAttribute("id");if(utils.isArray(settings.negative_cls)){for(var i=0;i<settings.negative_cls.length;i++)if(domUtil.hasClass(node,settings.negative_cls[i]))return!1}else if(utils.isString(settings.negative_cls))return!domUtil.hasClass(node,settings.negative_cls);return!(!config.isCustomPositiveCls()&&(PATTERN_TO_IGNORE.test(id)||PATTERN_TO_IGNORE.test(className)))&&!!domUtil.isElementVisible(node)}function processNodes(elem,textNodeCb,elemNodeCb,otherElemsCb,endCb,isLast){function traverse(){for(var e=0;100>e&&nodes.length;e++){var node=nodes.shift(),tagName=node.tagName;if(node.nodeType===Node.TEXT_NODE)textNodeCb(node);else if(isHeader(tagName))otherElemsCb(node,tagName);else if(isAllowed(node,tagName)){elemNodeCb(node);for(var c=0,l=node.childNodes.length;l>c;c++)nodes.push(node.childNodes[c])}}nodes.length?setTimeout(traverse,20):endCb(isLast)}var nodes=[elem];traverse()}function processCallback(isLast){var len;isLast&&(len=textNodes.length,callback(textNodes),settings.debug===!0&&"console"in window&&"info"in window.console&&console.info("nodes: "+len+" time: "+((new Date).getTime()-start)),settings.debug===!0&&!len&&"console"in window&&"info"in window.console&&console.info("Convertext Widget: No usable content nodes found. Consider using positive-cls parameter to specify concrete HTML nodes with content for extraction."))}for(var start,textNodes=[],elements=config.getPositiveCls(),e=0;e<elements.length;e++)start=(new Date).getTime(),processNodes(elements[e],processTextNodes,processElemNodes,processOtherElemNodes,processCallback,e===elements.length-1)},headers:function(){return[].concat(extractedHeaders)},links:function(){var links=[];if(config.isCustomPositiveCls()){var elements=config.getPositiveCls();utils.each(elements,function(element){utils.each(element.getElementsByTagName("a"),function(link){links.push(link)})})}else links=_document_.getElementsByTagName("a");return links},title:function(){return _document_.getElementsByTagName("title")[0].textContent},url:function(){return browserUtils.getDocument().location.href},extractUsableInfoFromNode:function(node){var ch,textNode=node.nodeType===Node.TEXT_NODE;textNode&&(ch=node,node=node.parentNode);var info={textContent:textNode?ch.textContent:node.textContent,tagName:node.tagName,classes:node.className,id:node.id};return"A"===info.tagName&&(info.href=node.href),info}}},{"../config":3,"./browser":9,"./common":10,"./dom":12,"./text":17}],14:[function(require,module,exports){"use strict";var config=require("../config"),utils=require("./common"),jsonUtils=require("./json3"),ActiveXObject=ActiveXObject||{};module.exports={post:function(path,data,cb){var ajaxParameters={type:"POST",url:config.api.host+path,data:data,success:cb||function(){}};this.ajax(ajaxParameters)},param:function(key,val){var prop,paramList=[];if(val===!0)val="1";else if(val===!1)val="0";else if("function"==typeof val)val=val();else if(null!==val&&"object"==typeof val){for(prop in val)val.hasOwnProperty(prop)&&null!==val[prop]&&paramList.push(this.param(key+"["+prop+"]",val[prop]));return paramList.join("&")}if("function"!=typeof val)return encodeURIComponent(key)+"="+encodeURIComponent(val);throw new Error},params:function(obj){var paramList=[];for(var key in obj)if(obj.hasOwnProperty(key)){var value=obj[key],param=this.param(key,value);param&&paramList.push(param)}return paramList.join("&")},ajax:function(request){if(request=utils.extend({"Content-Type":"application/json;charset=UTF-8",dataType:"json"},request),request.async=request.async||!0,"POST"===request.type){var xhrParameters={method:"POST",url:request.url,dataType:request.dataType,data:request.data,success:function(o){request.success(o)}};request["Content-Type"]&&(xhrParameters.headers={"Content-Type":request["Content-Type"],"X-Requested-With":"XMLHttpRequest"}),this.request(xhrParameters)}else{var path=utils.isEmpty(request.data)?"":(request.url.match(/\?/)?"&":"?")+request.data;this.request({method:"GET",dataType:request.dataType,url:request.url+path,success:function(o){request.success(o)}})}},request:function(){var isHostMethod=function(object,property){var t=typeof object[property];return"function"===t||!("object"!==t||!object[property])||"unknown"===t},getXhr=function(){if(isHostMethod(window,"XMLHttpRequest"))return function(){return new XMLHttpRequest};var item=function(){for(var list=["Microsoft","Msxml2","Msxml3"],len=list.length;len--;)try{item=list[len]+".XMLHTTP";new ActiveXObject(item);return item}catch(e){}}();return function(){return new ActiveXObject(item)}}();return function(config){config=utils.extend({method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},success:Function.prototype,error:function(msg){utils.throwError(msg)},complete:Function.prototype,data:{},timeout:2e4},config);var success=config.success,error=config.error,complete=config.complete,isPOST="POST"===config.method,data=config.data,req=getXhr(),url=!isPOST&&data?config.url+(config.url.indexOf("?")!==-1?"&":"?")+data:config.url;req.open(config.method,url,!0);for(var prop in config.headers)config.headers.hasOwnProperty(prop)&&config.headers[prop]&&req.setRequestHeader(prop,config.headers[prop]);var timeout;timeout=setTimeout(function(){var readyState=req.readyState||null;req.onreadystatechange=Function.prototype,req.abort(),req=null;var cdData={message:"Request Timeout ("+config.timeout+"ms)",status:0,data:null,readyState:readyState,toString:function(){return this.message+" Status: "+this.status}};error(cdData),complete(cdData)},config.timeout),req.onreadystatechange=function(){if(4===req.readyState){clearTimeout(timeout);for(var m,rawHeaders=req.getAllResponseHeaders(),headers={},headers_lowercase={},reHeader=/([a-zA-Z0-9-_]+):\s+(.*)$/gm;m=reHeader.exec(rawHeaders);)headers_lowercase[m[1].toLowerCase()]=headers[m[1]]=m[2];var cbData={};req.status<200||req.status>=300&&1223!==req.status?(cbData={status:req.status,data:req.responseText},error(cbData)):(cbData={status:req.status,headers:headers},200===req.status&&(cbData.data="json"===config.dataType&&JSON?jsonUtils.parse(req.responseText):req.responseText),success(cbData)),complete(cbData),req.onreadystatechange=Function.prototype,req=null}},req.send(isPOST?data:"")}}()}},{"../config":3,"./common":10,"./json3":15}],15:[function(require,module,exports){(function(global){(function(){function runInContext(context,exports){function attempt(func,errorFunc){try{func()}catch(exception){errorFunc&&errorFunc()}}function has(name){if(null!=has[name])return has[name];var isSupported;if("bug-string-char-index"==name)isSupported="a"!="a"[0];else if("json"==name)isSupported=has("json-stringify")&&has("date-serialization")&&has("json-parse");else if("date-serialization"==name){if(isSupported=has("json-stringify")&&isExtended){var stringify=exports.stringify;attempt(function(){isSupported='"-271821-04-20T00:00:00.000Z"'==stringify(new Date((-864e13)))&&'"+275760-09-13T00:00:00.000Z"'==stringify(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==stringify(new Date((-621987552e5)))&&'"1969-12-31T23:59:59.999Z"'==stringify(new Date((-1)))})}}else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==name){var stringify=exports.stringify,stringifySupported="function"==typeof stringify;stringifySupported&&((value=function(){return 1}).toJSON=value,attempt(function(){stringifySupported="0"===stringify(0)&&"0"===stringify(new Number)&&'""'==stringify(new String)&&stringify(getClass)===undefined&&stringify(undefined)===undefined&&stringify()===undefined&&"1"===stringify(value)&&"[1]"==stringify([value])&&"[null]"==stringify([undefined])&&"null"==stringify(null)&&"[null,null,null]"==stringify([undefined,getClass,null])&&stringify({a:[value,!0,!1,null,"\0\b\n\f\r\t"]})==serialized&&"1"===stringify(null,value)&&"[\n 1,\n 2\n]"==stringify([1,2],null,1)},function(){stringifySupported=!1})),isSupported=stringifySupported}if("json-parse"==name){var parseSupported,parse=exports.parse;"function"==typeof parse&&attempt(function(){0!==parse("0")||parse(!1)||(value=parse(serialized),parseSupported=5==value.a.length&&1===value.a[0],parseSupported&&(attempt(function(){parseSupported=!parse('"\t"')}),parseSupported&&attempt(function(){parseSupported=1!==parse("01")}),parseSupported&&attempt(function(){parseSupported=1!==parse("1.")})))},function(){parseSupported=!1}),isSupported=parseSupported}}return has[name]=!!isSupported}function dateToJSON(key){return serializeDate(this)}context||(context=root.Object()),exports||(exports=root.Object());var Number=context.Number||root.Number,String=context.String||root.String,Object=context.Object||root.Object,Date=context.Date||root.Date,SyntaxError=context.SyntaxError||root.SyntaxError,TypeError=context.TypeError||root.TypeError,Math=context.Math||root.Math,nativeJSON=context.JSON||root.JSON;"object"==typeof nativeJSON&&nativeJSON&&(exports.stringify=nativeJSON.stringify,exports.parse=nativeJSON.parse);var undefined,objectProto=Object.prototype,getClass=objectProto.toString,isProperty=objectProto.hasOwnProperty,isExtended=new Date((-0xc782b5b800cec));if(attempt(function(){isExtended=isExtended.getUTCFullYear()==-109252&&0===isExtended.getUTCMonth()&&1===isExtended.getUTCDate()&&10==isExtended.getUTCHours()&&37==isExtended.getUTCMinutes()&&6==isExtended.getUTCSeconds()&&708==isExtended.getUTCMilliseconds()}),has["bug-string-char-index"]=has["date-serialization"]=has.json=has["json-stringify"]=has["json-parse"]=null,!has("json")){var functionClass="[object Function]",dateClass="[object Date]",numberClass="[object Number]",stringClass="[object String]",arrayClass="[object Array]",booleanClass="[object Boolean]",charIndexBuggy=has("bug-string-char-index"),forOwn=function(object,callback){var Properties,members,property,size=0;(Properties=function(){this.valueOf=0}).prototype.valueOf=0,members=new Properties;for(property in members)isProperty.call(members,property)&&size++;return Properties=members=null,size?forOwn=function(object,callback){var property,isConstructor,isFunction=getClass.call(object)==functionClass;for(property in object)isFunction&&"prototype"==property||!isProperty.call(object,property)||(isConstructor="constructor"===property)||callback(property);(isConstructor||isProperty.call(object,property="constructor"))&&callback(property)}:(members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],forOwn=function(object,callback){var property,length,isFunction=getClass.call(object)==functionClass,hasProperty=!isFunction&&"function"!=typeof object.constructor&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object)isFunction&&"prototype"==property||!hasProperty.call(object,property)||callback(property);for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}),forOwn(object,callback)};if(!has("json-stringify")&&!has("date-serialization")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},leadingZeroes="000000",toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)},serializeDate=function(value){var getData,year,month,date,time,hours,minutes,seconds,milliseconds;if(isExtended)getData=function(value){year=value.getUTCFullYear(),month=value.getUTCMonth(),date=value.getUTCDate(),hours=value.getUTCHours(),minutes=value.getUTCMinutes(),seconds=value.getUTCSeconds(),milliseconds=value.getUTCMilliseconds()};else{var floor=Math.floor,Months=[0,31,59,90,120,151,181,212,243,273,304,334],getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)};getData=function(value){for(date=floor(value/864e5),year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month),time=(value%864e5+864e5)%864e5,hours=floor(time/36e5)%24,minutes=floor(time/6e4)%60,seconds=floor(time/1e3)%60,milliseconds=time%1e3}}return(serializeDate=function(value){return value>-1/0&&value<1/0?(getData(value),value=(year<=0||year>=1e4?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z",year=month=date=hours=minutes=seconds=milliseconds=null):value=null,value})(value)};if(has("json-stringify")&&!has("date-serialization")){var nativeStringify=exports.stringify;exports.stringify=function(source,filter,width){var nativeToJSON=Date.prototype.toJSON;Date.prototype.toJSON=dateToJSON;var result=nativeStringify(source,filter,width);return Date.prototype.toJSON=nativeToJSON,result}}else{var unicodePrefix="\\u00",escapeChar=function(character){var charCode=character.charCodeAt(0),escaped=Escapes[charCode];return escaped?escaped:unicodePrefix+toPaddedString(2,charCode.toString(16))},reEscape=/[\x00-\x1f\x22\x5c]/g,quote=function(value){return reEscape.lastIndex=0,'"'+(reEscape.test(value)?value.replace(reEscape,escapeChar):value)+'"'},serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,type,className,results,element,index,length,prefix,result;if(attempt(function(){value=object[property]}),"object"==typeof value&&value&&value.getUTCFullYear&&getClass.call(value)==dateClass&&value.toJSON===Date.prototype.toJSON&&(value=serializeDate(value)),callback&&(value=callback.call(object,property,value)),value==undefined)return value===undefined?value:"null";switch(type=typeof value,"object"==type&&(className=getClass.call(value)),className||type){case"boolean":case booleanClass:return""+value;case"number":case numberClass:return value>-1/0&&value<1/0?""+value:"null";case"string":case stringClass:return quote(""+value)}if("object"==typeof value){for(length=stack.length;length--;)if(stack[length]===value)throw TypeError();if(stack.push(value),results=[],prefix=indentation,indentation+=whitespace,className==arrayClass){for(index=0,length=value.length;index<length;index++)element=serialize(index,value,callback,properties,whitespace,indentation,stack),results.push(element===undefined?"null":element);result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else forOwn(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);element!==undefined&&results.push(quote(property)+":"+(whitespace?" ":"")+element)}),result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}";
return stack.pop(),result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter)if(className=getClass.call(filter),className==functionClass)callback=filter;else if(className==arrayClass){properties={};for(var value,index=0,length=filter.length;index<length;value=filter[index++],className=getClass.call(value),(className==stringClass||className==numberClass)&&(properties[value]=1));}if(width)if(className=getClass.call(width),className==numberClass){if((width-=width%1)>0)for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}else className==stringClass&&(whitespace=width.length<=10?width:width.slice(0,10));return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}}if(!has("json-parse")){var Index,Source,fromCharCode=String.fromCharCode,Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},abort=function(){throw Index=Source=null,SyntaxError()},lex=function(){for(var value,begin,position,isSigned,charCode,source=Source,length=source.length;Index<length;)switch(charCode=source.charCodeAt(Index)){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:return value=charIndexBuggy?source.charAt(Index):source[Index],Index++,value;case 34:for(value="@",Index++;Index<length;)if(charCode=source.charCodeAt(Index),charCode<32)abort();else if(92==charCode)switch(charCode=source.charCodeAt(++Index)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode],Index++;break;case 117:for(begin=++Index,position=Index+4;Index<position;Index++)charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70||abort();value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}else{if(34==charCode)break;for(charCode=source.charCodeAt(Index),begin=Index;charCode>=32&&92!=charCode&&34!=charCode;)charCode=source.charCodeAt(++Index);value+=source.slice(begin,Index)}if(34==source.charCodeAt(Index))return Index++,value;abort();default:if(begin=Index,45==charCode&&(isSigned=!0,charCode=source.charCodeAt(++Index)),charCode>=48&&charCode<=57){for(48==charCode&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)&&abort(),isSigned=!1;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(46==source.charCodeAt(Index)){for(position=++Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);position==Index&&abort(),Index=position}if(charCode=source.charCodeAt(Index),101==charCode||69==charCode){for(charCode=source.charCodeAt(++Index),43!=charCode&&45!=charCode||Index++,position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);position==Index&&abort(),Index=position}return+source.slice(begin,Index)}isSigned&&abort();var temp=source.slice(Index,Index+4);if("true"==temp)return Index+=4,!0;if("fals"==temp&&101==source.charCodeAt(Index+4))return Index+=5,!1;if("null"==temp)return Index+=4,null;abort()}return"$"},get=function(value){var results,hasMembers;if("$"==value&&abort(),"string"==typeof value){if("@"==(charIndexBuggy?value.charAt(0):value[0]))return value.slice(1);if("["==value){for(results=[];value=lex(),"]"!=value;)hasMembers?","==value?(value=lex(),"]"==value&&abort()):abort():hasMembers=!0,","==value&&abort(),results.push(get(value));return results}if("{"==value){for(results={};value=lex(),"}"!=value;)hasMembers?","==value?(value=lex(),"}"==value&&abort()):abort():hasMembers=!0,","!=value&&"string"==typeof value&&"@"==(charIndexBuggy?value.charAt(0):value[0])&&":"==lex()||abort(),results[value.slice(1)]=get(lex());return results}abort()}return value},update=function(source,property,callback){var element=walk(source,property,callback);element===undefined?delete source[property]:source[property]=element},walk=function(source,property,callback){var length,value=source[property];if("object"==typeof value&&value)if(getClass.call(value)==arrayClass)for(length=value.length;length--;update(value,length,callback));else forOwn(value,function(property){update(value,property,callback)});return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;return Index=0,Source=""+source,result=get(lex()),"$"!=lex()&&abort(),Index=Source=null,callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}return exports.runInContext=runInContext,exports}var isLoader="function"==typeof define&&define.amd,objectTypes={"function":!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal),freeExports&&!isLoader)runInContext(root,freeExports);else{var nativeJSON=root.JSON,previousJSON=root.JSON3,isRestored=!1,JSON3=runInContext(root,root.JSON3={noConflict:function(){return isRestored||(isRestored=!0,root.JSON=nativeJSON,root.JSON3=previousJSON,nativeJSON=previousJSON=null),JSON3}});module.exports={parse:JSON3.parse,stringify:JSON3.stringify}}isLoader&&define(function(){return JSON3})}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(require,module,exports){"use strict";function SortBy(compare){function less(v,w){return compare(v,w)<0}function merge(a,aux,lo,mid,hi){for(var k=lo;k<=hi;k++)aux[k]=a[k];for(var i=lo,j=mid+1,p=lo;p<=hi;p++)i>mid?a[p]=aux[j++]:j>hi?a[p]=aux[i++]:less(aux[j],aux[i])?a[p]=aux[j++]:a[p]=aux[i++]}function sortPart(a,aux,lo,hi){if(!(hi<=lo)){if(hi<=lo+CUTOFF-1)return void insertionSort(a,lo,hi);var mid=Math.floor(lo+(hi-lo)/2);sortPart(a,aux,lo,mid),sortPart(a,aux,mid+1,hi),less(a[mid+1],a[mid])&&merge(a,aux,lo,mid,hi)}}function exchange(a,i,j){var swap=a[i];a[i]=a[j],a[j]=swap}function insertionSort(a,lo,hi){lo||(lo=0),hi||(hi=a.length-1);for(var i=lo;i<=hi;i++)for(var j=i;j>lo&&less(a[j],a[j-1]);j--)exchange(a,j,j-1)}var CUTOFF=7;this.sort=function(a){var aux=[];sortPart(a,aux,0,a.length-1)}}function configure(a,compare){a&&utils.isArray(a)||utils.throwError("You need to call this function with array for sorting as a first argument."),compare&&utils.isFunction(compare)||utils.throwError("You need to call this function with function compare(v, w) as a second argument.");var by=new SortBy(compare);by.sort(a)}var utils=require("./common");module.exports=configure},{"./common":10}],17:[function(require,module,exports){"use strict";var U_CHARS="[A-Za-z---]",URL_REGEXP=/^(?:http|ftp)s?:\/\/(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+)$/gi,SENTENCE_REGEXP=/[A-Za-z0-9][^.!?]*(?:![.!?](?!["']?\s|$)[^.!?]*)*[.!?]?["']?(?=\s|$)/,WORD_REGEXP=new RegExp("("+U_CHARS+"{3,})","gm"),WHITESPACE="[\\x20\\t\\r\\n\\f]",TRIM_REGEXP=new RegExp("^"+WHITESPACE+"+|((?:^|[^\\\\])(?:\\\\.)*)"+WHITESPACE+"+$","g");module.exports={escapeStr:function(str){var expr=/\s+/g,chars=/[-[\]{}()*+?.,\\^$|#\s]/g;return str.replace(chars,"\\$&").replace(expr,"s+")},isNodeWhitespace:function(node){return!(!node||node.nodeType!==Node.TEXT_NODE)&&!/\S/.test(node.data)},rmDoubleSpace:function(str){return str.replace(/\s\s/g," ")},trim:function(str){return null===str?"":(str+"").replace(TRIM_REGEXP,"")},rmNewLines:function(str){return str.replace(/\n+/g," ")},isItSentence:function(str){return SENTENCE_REGEXP.test(str)},wordsCounter:function(str){var words=str.match(WORD_REGEXP);return words?words.length:0},clearText:function(str){return this.rmDoubleSpace(this.rmNewLines(this.trim(str)))},isItUrl:function(str){return URL_REGEXP.test(str)},isContainText:function(content,text){return~content.indexOf(text)},escape:function(str){return str.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},indexOfPhrase:function(content,phrase){function beginningWord(word){var startChars=startWithCharsReg.exec(word);null!==startChars&&(startChars[0]&&(start+=startChars[0].length),beginningWord(content.slice(start,start+escapedPhrase.length)))}var escapedPhrase=this.escape(phrase),reg=new RegExp("(^|[ \n\r\t.,'\"+!?-]+)("+escapedPhrase+")([ \n\r\t.,'\"+!?-]+|$)","m"),startWithCharsReg=new RegExp("^[ \n\r\t.,'\"+!?-]+","m"),start=content.search(reg);if(start!==-1){var word=content.slice(start,start+escapedPhrase.length);beginningWord(word)}return start},indexOfPhraseLatin:function(content,phrase){return content.search(new RegExp("\\b"+this.escape(phrase)+"\\b","m"))},isContainPhrase:function(content,phrase){return~this.indexOfPhrase(content,phrase)},withinString:function(string,callback){var findUri={start:/\b([a-z][a-z0-9.+-]*:\/\/.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?]+$/},_start=findUri.start,_end=findUri.end,_trim=findUri.trim;for(_start.lastIndex=0;;){var match=_start.exec(string);if(!match)break;var start=match.index,end=start+string.slice(start).search(_end),slice=string.slice(start,end).replace(_trim,"");end=start+slice.length;var result=callback(slice,start,end,string);string=string.slice(0,start)+result+string.slice(end),_start.lastIndex=start+result.length}return _start.lastIndex=0,string}}},{}],18:[function(require,module,exports){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};if(canPost){var queue=[];return window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}}return function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}]},{},[4]);
//# sourceMappingURL=/static/convertext/convertext.js.map
